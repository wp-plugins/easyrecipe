window.EASYRECIPE=window.EASYRECIPE||{};EASYRECIPE.widget=EASYRECIPE.widget||jQuery.widget;EASYRECIPE.button=EASYRECIPE.button||jQuery.fn.button;
(function(a){function Eb(a,c){Qa.show();V.hide();Ra.show();switch(c.newTab?c.newTab.index():c.index){case 0:V.css("right","10px");V.show();break;case 3:V.css("right","inherit");Ra.hide();V.show();break;case 4:Qa.hide()}}function Sa(){ya.off("change",Sa);O=!0}function g(a){return a?(a+"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&nbsp;/g," "):""}function W(d){return d?a("<div />").text(d).html():""}function p(d){return a.trim(W(d.val()))||!1}function Fb(a,c){var b=za.tabs("option",
"active");za.tabs("option","active",++b)}function v(a){var c,b=/\[img +(.*?) *\/?\]/i,f=/\[url ([^\]]+)\](.*?\[\/url\])/i,e=/\[cap ([^\]]+)\](.*])(.*?)\[\/cap\]/i;if(""!==a){for(c=b.exec(a);null!==c;)X.push(c[1].replace(/</g,"&lt;").replace(/>/g,"&gt;")),a=a.replace(b,"[img:"+X.length+"]"),c=b.exec(a);for(c=f.exec(a);null!==c;)C.push(c[1]),a=a.replace(f,"[url:"+C.length+"]$2"),c=f.exec(a);for(c=e.exec(a);null!==c;)fa.push(c[1]),Ta.push(c[3].replace(/</g,"&lt;").replace(/>/g,"&gt;")),a=a.replace(e,
"[cap:"+fa.length+"]$2[/cap]"),c=e.exec(a)}return a}function w(a){var c,b,f=/\[img:(\d+)\]/i,e=/\[url:(\d+)\](.*?)\[\/url\]/i,n=/\[cap:(\d+)\](.*\])\[\/cap\]/i;if(a){for(b=f.exec(a);null!==b;)c=X[b[1]-1].replace(/&quot;/g,"&amp;quot;"),a=a.replace(f,"[img "+c+"]"),b=f.exec(a);for(b=e.exec(a);null!==b;)c=C[b[1]-1],a=a.replace(e,"[url "+c+"]$2[/url]"),b=e.exec(a);for(b=n.exec(a);null!==b;)c=fa[b[1]-1],b=Ta[b[1]-1],a=a.replace(n,"[cap "+c+"]$2"+b+"[/cap]"),b=e.exec(a)}return a}function nb(a,c){var b,
f,e,n=0,l="",k,g,h,q,r;b=a;for(c=c||{};;){e=b.length;f=b.indexOf("#",n);-1!==f&&(e=f,k=0);f=b.indexOf("\x3c!-- START REPEAT ",n);-1!==f&&f<e&&(e=f,k=1);f=b.indexOf("\x3c!-- START INCLUDEIF ",n);-1!==f&&f<e&&(e=f,k=2);if(e===b.length)return l+b.substr(n);f=e-n;l+=b.substr(n,f);n=e;switch(k){case 2:e=b.substr(n,44);e=Gb.exec(e);if(null!==e)f=e[1],g="!"!==f,h=e[2];else break;q="\x3c!-- END INCLUDEIF "+f+h+" --\x3e";e=q.length;q=b.indexOf(q);if(-1===q){n++;break}r=typeof c[h]!==Aa&&!1!==c[h];r===g?(f=
"\x3c!-- START INCLUDEIF "+f+h+" --\x3e",f=f.length,b=b.substr(0,n)+b.substr(n+f,q-n-f)+b.substr(q+e)):b=b.substr(0,n)+b.substr(q+e);break;case 0:e=b.substr(n,22);e=Hb.exec(e);if(null===e){l+="#";n++;continue}e=e[1];if(""!==c[e]&&!c[e]){l+="#"+e+"#";n+=e.length+2;continue}l+=c[e];n+=e.length+2;break;case 1:e=b.substr(n,45);e=Ib.exec(e);if(null===e){l+="<";n++;continue}e=e[1];if(!(c[e]&&c[e]instanceof Array)){l+="<";n++;continue}n+=e.length+22;f=b.indexOf("\x3c!-- END REPEAT "+e+" --\x3e",n);if(-1===
f){l+="\x3c!-- START REPEAT "+e+" --\x3e";continue}g=f-n;q=b.substr(n,g);h=c[e];for(f=0;f<h.length;f++)l+=nb(q,h[f]);n+=e.length+g+20}}}function Ba(d){var c=a.trim(d.val()),b=0,f=0;Ua.hide();if(""===c)return!0;m=Va.exec(c);if(null===m){m=Jb.exec(c);if(null===m)return Ua.show(),!1;b=0;f=m[1]}else b=m[1]?parseInt(m[1],10):0,f=m[2]?parseInt(m[2],10):0;0===b&&0===f?d.val(""):(c=0<b?b+" hour":"",1<b&&(c+="s"),b=0<f?f+" min":"",1<f&&(b+="s"),d.val(a.trim(c+" "+b)));return!0}function ob(d){var c,b,f="";
for(c=0;c<d.length;c++)b=d[c],3===b.nodeType?(b=a.trim(b.nodeValue),""!==b&&(f+=b+"\n")):1===b.nodeType&&0<b.childNodes.length&&(f+=ob(b.childNodes));return f}function pb(){var d;a(Wa,t).remove();d=P.selection.getNode();"#document"===d.nodeName&&(d=Ca[0]);if("BODY"===d.nodeName.toUpperCase())a(d).hasClass("mceContentBody")||(d=Ca[0]),/^<p><br[^>]*><\/p>$/.test(d.innerHTML)?a(d).prepend(ha):a(d).append("&nbsp;"+ha);else{for(;d.parentNode&&"BODY"!==d.parentNode.nodeName.toUpperCase();)d=d.parentNode;
d.parentNode?"DIV"===d.nodeName.toUpperCase()||"SPAN"===d.nodeName.toUpperCase()?a(d,t).after(ha):a(d,t).before(ha):(d=Ca[0],a(d).append("&nbsp;"+ha))}Y=-1;return a(Wa,t)}function Kb(a,c,b){}function Lb(d){switch(d.type){case "js":a("head").append(a('<script type="text/javascript">'+d.js+"\x3c/script>"));r[d.f]();break;case "html":a(d.dest).html(d.html)}}function Mb(){Da.unbind(E);Ea.unbind(E);Q.dialog(J);Xa=!0;Ya()}function Nb(d,c){var b,f="",e;e=d.recipe;"success"!==c&&(Q.dialog(J),Xa=!0,Ya());
K.val(g(e.recipe_title));e.rating&&a.isNumeric(e.rating)&&Za.val(e.rating);x=e.recipe_image;L.val("");e.author?B.val(g(e.author)):B.val("");R.val(e.cuisine||"");L.val(e.mealType||"");$a.val("");M.val(g(e.summary));m=qb.exec(e.prep_time);null!==m?(b=m[1]?m[1]+"h ":"",y.val(b+m[2]+"m")):y.val(g(e.prep_time));m=qb.exec(e.cook_time);null!==m?(b=m[1]?m[1]+"h ":"",z.val(b+m[2]+"m")):z.val(g(e.cook_time));S.val(g(e.yield));Z.val(g(e.serving_size));e.nutrition?(b=e.nutrition,$.val(g(b.calories)),aa.val(g(b.totalFat)),
ia.val(g(b.saturatedFat)),ja.val(g(b.unsaturatedFat)),ka.val(g(b.transFat)),la.val(g(b.totalCarbohydrates)),ma.val(g(b.sugars)),na.val(g(b.sodium)),oa.val(g(b.dietaryFiber)),pa.val(g(b.protein)),qa.val(g(b.cholesterol))):($.val(g(e.calories)),aa.val(g(e.fat)));for(b=0;b<d.ingredients.length;b++)f+=Ob(g(d.ingredients[b]))+"\n";ra.val(f);sa.val(g(e.instructions.replace("\r","")));ta.val(g(e.notes));A.easyrecipeDialog("option","title","Update Recipe");Q.dialog(J);Fa.hide();Ga.show();Ha.hide();""!==x&&
rb(x,u.length,!0);h=pb();A.easyrecipeDialog(F)}function Pb(){Ia.show();Da.unbind(E);Ea.unbind(E);a.post(ajaxurl,{action:"easyrecipeConvert",id:ab,type:Ja},Nb,"json")}function bb(d){var c,b,f=0,e="",n="",l="",k="",g=["instruction","method","cooking method","procedure","direction"];b=["ingredients?"];var h=["note","cooking note"],q,m;q=a.parseJSON(r.ingredients);m=a.parseJSON(r.instructions);c=a.parseJSON(r.notes);-1===a.inArray(q,b)&&b.push(q);q="^\\s*(?:"+b.join("|")+")";q=new RegExp(q,"i");-1===
a.inArray(m,g)&&b.push(m);g="^\\s*(?:"+g.join("|")+")";g=new RegExp(g,"i");-1===a.inArray(c,h)&&h.push(c);h="^\\s*(?:"+h.join("|")+")\\s*$";h=new RegExp(h,"i");d=a("<div>"+d+"</div>");d=ob(d[0].childNodes);d=d.split("\n");for(c=0;c<d.length;c++)if(b=a.trim(d[c]),""!==b)if(g.test(b))f=2;else if(q.test(b))f=1;else if(h.test(b))f=3;else switch(f){case 0:e+=b+"\n";break;case 1:n+=b+"\n";break;case 2:l+=b+"\n";break;case 3:k+=b+"\n"}return{summary:e,ingredients:n,instructions:l,notes:k}}function ba(d,
c,b){G.append('<div class="ERPhoto"><img style="position:relative" id="ERPhoto_'+c+'" /></div>');u[c]=a("#ERPhoto_"+c,G);u[c].data("src",d);b&&(a(".ERPhoto",G).removeClass(ca),u[c].parent().addClass(ca),H=c,x=d);""===Ka&&(Ka=d);b=new Image;a.data(b,"index",c);b.onload=function(){var b,d,c=a.data(this,"index");b=this.width/150;d=this.height/112;b=b>d?b:d;d=Math.floor(this.height/b);b=Math.floor(this.width/b);u[c].height(d);u[c].width(b);u[c].css("top",(112-d)/2);u[c].attr("src",this.src);0===c&&a("#ERDTabs").find(".divERNoPhotos").remove()};
b.src=d}function Qb(){ba(cb.val(),u.length,!0);cb.val("");db.hide();a(".divERNoPhotos").remove()}function La(a,c){var b,f=!1;for(b=0;b<u.length;b++)if(u[b].data("src")===a){f=!0;break}f||ba(a,u.length,c)}function Ma(d,c){var b,f,e,n,l,k,m,p={},q=l="",ga="";e="";if(c===ua&&0!==D)T.dialog(F);else if(d&&d.data===Na&&(c=Na,d=d.delegateTarget),typeof c===Aa&&typeof d===Aa&&(Y=0),D=1,Y=0,h=a(".easyrecipe:first",t),c!==ua&&1<h.length&&(h=a(h[c]),Y=c),k=a.support.cors?"json":"jsonp",a.ajax(Rb,{dataType:k,
data:{v:r.version,p:0,u:r.wpurl},success:Lb,error:Kb}),eb=!1,typeof tinyMCE!==Aa&&tinyMCE.activeEditor&&!tinyMCE.activeEditor.isHidden()&&(eb=!0),eb){K.val("");L.val("");R.val("");$a.val("");B.val("");M.val("");y.val("");z.val("");S.val("");ra.val("");sa.val("");Z.val("");$.val("");aa.val("");ia.val("");ja.val("");ka.val("");la.val("");ma.val("");na.val("");oa.val("");pa.val("");qa.val("");ta.val("");if(c!==ua&&1===h.length)A.easyrecipeDialog("option","title","Update Recipe"),Ha.hide(),Fa.hide(),
Ga.show(),fb=!0;else{Oa=P.getContent();if(!Xa&&((k=Sb.exec(Oa)||Tb.exec(Oa)||Ub.exec(Oa))||(b=a("#hasRecipe").is(":checked")),k||b)){b?(Ja="recipress",ab=r.postID):(Ja=k[2],ab=k[3]);Ia.hide();Da.click(Mb);Ea.click(Pb);e=Vb[Ja];l=a("#txtERCNVText1",Q);l.html(l.html().replace("#plugin#",e));G.html("");H=-1;u=[];G.html(sb);Q.dialog(F);return}r.isGuest&&(k=a("#inpERAuthor").val()||"",B.val(k));Fa.show();Ga.hide();Ha.show();A.easyrecipeDialog("option","title","Add a New Recipe");fb=!1;!1!==Pa?p=bb(Pa):
(k=P.selection.getContent(),20<k.length&&(p=bb(k)));p.summary&&(l=p.summary);p.ingredients&&(q=p.ingredients);p.instructions&&(ga=p.instructions);p.notes&&(e=p.notes);h=pb()}p=h;h=a("<div>"+h.html()+"</div>");a("#inpERCuisine").autocomplete({source:a.parseJSON(r.cuisines)}).autocomplete("widget").wrap('<div class="easyrecipeUI" />');a("#inpERType").autocomplete({source:a.parseJSON(r.recipeTypes)}).autocomplete("widget").wrap('<div class="easyrecipeUI" />');O=!1;ya.off("change",Sa).on("change",Sa);
gb=!1;0<a(".hrecipe",t).length&&confirm("This post is already hrecipe microformatted\n\nDo you want me to try to convert it to an EasyRecipe?")&&(gb=!0);da=c!==ua?h.find(".endeasyrecipe").text():r.version;""===da&&(da="2.2");x=a('link[itemprop="image"]',h).attr("href")||"";G.html("");H=-1;Ka="";u=[];t.find("img").each(function(b){var d=!1;"3">da?a(this).hasClass("photo")&&(d=!0):d=this.src===x;ba(this.src,b,d)});b=t.contents().text();k=tb.exec(b);for(m=u.length;null!==k;)f=Wb.exec(k[0]),null!==f&&
(f=f[1],ba(f,m),"3"<da?x===f&&(u[m].parent().addClass(ca),H=m):Xb.test(k[0])&&(u[m].parent().addClass(ca),H=m,x=f),m++),k=tb.exec(b);""!==x&&La(x,!0);(ub=a("#set-post-thumbnail").find("img").attr("src"))&&La(ub,-1===H);-1===H&&0<u.length&&(H=0,x=Ka,u[0].parent().addClass(ca));G.click(function(){T.dialog(F)});0===u.length?G.html(sb):-1===H&&u[0].parent().addClass(ca);X=[];C=[];(k=h.find(".ERName .fn").html()||h.find(".ERName").html())&&""!==k?K.val(v(g(k))):K.val(v(g(a("#title").val())));L.val(v(g(h.find(".type").html())));
B.val(v(g(h.find(".author").html())));""===B.val()&&B.val(v(a.parseJSON(r.author)));R.val(v(g(h.find(".cuisine").html())));M.val(v(l+g(h.find(".summary").html())));"3"<da?(l=h.find('time[itemprop="prepTime"]').html()||"",y.val(g(l)),l=h.find('time[itemprop="cookTime"]').html()||"",z.val(g(l))):(l=h.find(".preptime").html()||"",k=vb.exec(l),null!==k?y.val(g(k[1])):y.val(""),l=h.find(".cooktime").html()||"",k=vb.exec(l),null!==k?z.val(g(k[1])):z.val(""));S.val(g(h.find(".yield").html()));h.find(".ingredients li").each(function(b,
d){q=a(d).hasClass(wb)?q+("!"+v(g(d.innerHTML))+"\n"):q+(v(g(d.innerHTML))+"\n")});ra.val(q);h.find(".instructions li, .instructions .ERSeparator").each(function(b,d){n=a.trim(d.innerHTML.replace(/^[ 0-9.]*(.*)$/ig,"$1"));ga=a(d).hasClass(wb)?ga+("!"+n+"\n"):ga+(n+"\n")});sa.val(v(g(ga)));Z.val(g(h.find(".servingSize").html()));$.val(g(h.find(".calories").html()));aa.val(g(h.find(".fat").html()));ia.val(g(h.find(".saturatedFat").html()));ja.val(g(h.find(".unsaturatedFat").html()));ka.val(g(h.find(".transFat").html()));
la.val(g(h.find(".carbohydrates").html()));ma.val(g(h.find(".sugar").html()));na.val(g(h.find(".sodium").html()));oa.val(g(h.find(".fiber").html()));pa.val(g(h.find(".protein").html()));qa.val(g(h.find(".cholesterol").html()));l=p.parent().prop("data-rating");Za.val(a.isNumeric(l)?l:"5");n=(g(h.find(".ERNotes").html())||"").replace(/<\/p>\n*<p>/ig,"\n\n").replace(/(?:<p>|<\/p>)/ig,"").replace(/<br *\/?>/ig,"\n");""===n&&""!==e&&(n=e);n=v(n);n=n.replace(/\[br(?: ?\/)?\]/ig,"\n");ta.val(v(n));s&&(s.name&&
K.val(v(g(s.name))),s.author&&B.val(v(s.author)),s.summary&&M.val(v(s.summary)),s.yield&&S.val(g(s.yield)),s.type&&L.val(v(g(s.type))),s.cuisine&&R.val(v(g(s.cuisine))),s.prepTime&&y.val(g(s.prepTime)),s.cookTime&&z.val(g(s.cookTime)),s.summary&&M.val(v(s.summary)));h=p;A.easyrecipeDialog(F);A.easyrecipeDialog("option","position","center")}else alert("You must use the Visual Editor to add or update an EasyRecipe")}function hb(d){D=a(".easyrecipe",t).length;Yb||0===D?Ma(d,ua):T.dialog(F)}function Zb(){A.easyrecipeDialog(J)}
function $b(){confirm("Are you sure you want to delete this recipe?")&&(h.remove(),O=h=!1);A.easyrecipeDialog(J)}function ac(){var d=a("#inpERPaste"),c,b=d.val();c=bb(b);if(0!==c.ingredients.length||0!==c.instructions.length)Pa=b,d.val(""),s={name:w(W(K.val())),author:w(p(B)),yield:p(S),type:w(p(L)),cuisine:w(p(R)),summary:w(p(M)),servesize:p(Z),prepTime:y.val(),cookTime:z.val()},O=!1,A.easyrecipeDialog(J),hb(null)}function ib(d){d=a(d.target).parent();var c=d.parent();d.hasClass("easyrecipeAbove")?
c.before(xb):c.after(xb);d.remove();yb()}function yb(){var d,c;c=a("<div>"+t[0].body.innerHTML+"</div>");c.find(".easyrecipeAbove,.easyrecipeBelow").remove();d=c.find(".easyrecipe");d.each(function(){var b=a(this);b.parent().hasClass("easyrecipeWrapper")&&b.unwrap();zb(b)});d=c.html();P.setContent(d);d=t.find(".easyrecipe");d.on("mousedown",null,Na,Ma);t.find(".ERInsertLine").on(E,ib)}function bc(a){var c,b;c=a.prev();b=a.next();if(c=0===c.length||c.hasClass("easyrecipe")||c.hasClass("easyrecipeWrapper"))try{c=
!(a[0].previousSibling&&3===a[0].previousSibling.nodeType)}catch(f){}if(b=0===b.length||b.hasClass("easyrecipe")||b.hasClass("easyrecipeWrapper"))try{b=!(a[0].nextSibling&&3===a[0].nextSibling.nodeType)}catch(e){}if(c||b)a.wrap('<div class="easyrecipeWrapper mceNonEditable" />'),a=a.parent(),c&&(a.prepend('<div class="easyrecipeAbove mceNonEditable"><input class="ERInsertLine mceNonEditable" type="button" value="Insert line above" /></div>'),a.find("input").on(E,ib),cc.push(a.find(".easyrecipeAbove")[0])),
b&&(a.append('<div class="easyrecipeBelow mceNonEditable"><input class="ERInsertLine mceNonEditable" type="button" value="Insert line below" /></div>'),a.find("input").on(E,ib))}function jb(){var d=a(".easyrecipe",t);0!==d.length&&(d.on("mousedown",null,Na,Ma),yb())}function Ab(){var d,c="",b,f="",e=0,g="",l,k,s,u=[],q,v;if(Ba(y)&&Ba(z)){b=a.trim(y.val());""!==b?(m=Va.exec(b),l=m[1]?parseInt(m[1],10):0,k=m[2]?parseInt(m[2],10):0,e=60*l+k,f="PT"+(0<l?l+"H":"")+(0<k?k+"M":"")):b=!1;d=a.trim(z.val());
""!==d?(m=Va.exec(d),l=m[1]?parseInt(m[1],10):0,k=m[2]?parseInt(m[2],10):0,e+=60*l+k,c="PT"+(0<l?l+"H":"")+(0<k?k+"M":"")):d=!1;0<e?(l=Math.floor(e/60),k=e%60,e=0<l?l+" hour":"",1<l&&(e+="s"),g=0<k?k+" min":"",1<k&&(g+="s"),e=a.trim(e+" "+g),g="PT"+(0<l?l+"H":"")+(0<k?k+"M":"")):e=!1;l=ra.val().split("\n");for(s=0;s<l.length;s++)k=l[s],""!==k&&("!"===k.charAt(0)?(q=!0,k=k.substr(1)):q=!1,u.push({ingredient:w(W(k)),hasHeading:q}));l=sa.val().split("\n");v=[];q={INSTRUCTIONS:[]};for(s=0;s<l.length;s++)k=
a.trim(l[s].replace(/^[ 0-9\.]*(.*)$/ig,"$1")),""!==k&&("!"===k.charAt(0)?((0<q.INSTRUCTIONS.length||q.heading)&&v.push(q),k=k.substr(1),q={INSTRUCTIONS:[]},q.heading=W(k)):q.INSTRUCTIONS.push({instruction:w(W(k))}));(0<q.INSTRUCTIONS.length||q.heading)&&v.push(q);(k=p(ta))&&(k=k.replace(/\n/g,"[br]"));d={version:r.version,hasPhoto:""!==x,photoURL:x,name:w(W(K.val())),author:w(p(B)),preptime:b,cooktime:d,totaltime:e,preptimeISO:f,cooktimeISO:c,totaltimeISO:g,yield:p(S),type:w(p(L)),cuisine:w(p(R)),
summary:w(p(M)),servesize:p(Z),calories:p($),fat:p(aa),satfat:p(ia),unsatfat:p(ja),transfat:p(ka),carbs:p(la),sugar:p(ma),sodium:p(na),fiber:p(oa),protein:p(pa),cholesterol:p(qa),notes:w(k),INGREDIENTS:u,STEPS:v};""===d.name&&(d.name=!1);d=nb(r.recipeTemplate,d);gb&&a(".hrecipe",t).remove();-1===Y?h=a(Wa,t):(h=a(".easyrecipe",t),0<h.length&&(h=a(h[Y])));h.before(d);h.remove();h=!1;U.css("display","inline-block");O=!1;A.easyrecipeDialog(J);D=a(".easyrecipe",t).length;jb()}}function dc(d,c,b){s=!1;
if("3"<tinymce.majorVersion){if(c.id!==I&&"wp_mce_fullscreen"!==c.id){a("#"+c.controlManager.buttons.easyrecipeTest._id).hide();a("#"+c.controlManager.buttons.easyrecipeEdit._id).hide();a("#"+c.controlManager.buttons.easyrecipeAdd._id).hide();return}c.id===I?(t=a("#"+I+"_ifr").contents(),d=a("#"+c.controlManager.buttons.easyrecipeTest._id),U=a("#"+c.controlManager.buttons.easyrecipeEdit._id)):(t=a("#wp_mce_fullscreen_ifr").contents(),d=a("#mce_fullscreen_easyrecipeTest"),U=a("#mce_fullscreen_easyrecipeEdit"))}else{if(c.editorId!==
I&&"wp_mce_fullscreen"!==c.editorId){a("#"+c.editorId+"_easyrecipeTest").hide();a("#"+c.editorId+"_easyrecipeEdit").hide();a("#"+c.editorId+"_easyrecipeAdd").hide();return}c.editorId===I?(t=a("#"+I+"_ifr").contents(),d=a("#"+I+"_easyrecipeTest"),U=a("#"+I+"_easyrecipeEdit")):(t=a("#wp_mce_fullscreen_ifr").contents(),d=a("#mce_fullscreen_easyrecipeTest"),U=a("#mce_fullscreen_easyrecipeEdit"))}Ca=a("body",t);c=a(".easyrecipe",t);P=tinyMCE.activeEditor;c.each(function(){a(this).addClass("mceNonEditable");
a(".ERRatingOuter",this).remove();a(".ERHDPrint",this).remove();a(".ERLinkback",this).remove()});D=c.length;0<D&&""!==r.testURL?d.show():d.hide();0<D?U.css("display","inline-block"):U.hide();t.hasERCSS||(a("head",t).append('<link rel="stylesheet" type="text/css" href="'+r.easyrecipeURL+"/css/easyrecipe-entry.css?ver="+r.version+'" />'),t.hasERCSS=!0);jb()}function ec(){Bb.toggleClass("ERNone");kb.toggleClass("ERContract")}function fc(){Cb.toggleClass("ERNone");lb.toggleClass("ERContract")}function gc(d){var c;
c=a("#ertmp_"+Db,t);C.push('href="'+d.href+'"'+(d.target?' target="'+d.target+'"':"")+(d.title?' title="'+d.title+'"':""));ea.val(N.substring(0,va)+"[url:"+C.length+"]"+N.substring(va,wa)+"[/url]"+N.substring(wa));ea[0].focus();c.remove()}function hc(d){var c,b,f;r.isEntryDialog&&(c=a("#ertmp_"+Db,t),"string"===typeof d?b=a(d):(d=c.html(),"link"===d?c=b=c.parent("a"):b=a(c.html())),b.is("a")&&(d=b.attr("href"),f=b.attr("title"),b=b.attr("target"),d='href="'+d+'"'+(b?' target="'+b+'"':"")+(f?' title="'+
f+'"':""),C.push(d),ea.val(N.substring(0,va)+"[url:"+C.length+"]"+N.substring(va,wa)+"[/url]"+N.substring(wa))),ea[0].focus(),c.remove())}function ic(d,c){var b,f,e,g,h,k,m,p,q,r,s,t;b=d.sizes[c.size];f=b.url;h=b.width;k=b.height;ba(f,u.length);m=tinymce.html.Entities.encodeAllRaw(a.trim(d.title));m=m.replace(/&quot;/g,"&amp;quot;");p=tinymce.html.Entities.encodeAllRaw(a.trim(d.alt));p=p.replace(/&quot;/g,"&amp;quot;");q=tinymce.html.Entities.encodeAllRaw(a.trim(d.caption));m=""!==m?' title="'+m+
'"':"";p=""!==p?' alt="'+p+'"':"";r="align"+c.align;g=d.uploadedTo?'id="attachment_'+d.uploadedTo+'" ':"";b=N.substring(0,va);""!==q?(fa.push(g+'align="'+r+'" width="'+h+'"'),Ta.push(q),g="[cap:"+fa.length+"]",q="[/cap]",r=""):g=q="";"none"===c.link?e=s=t="":"file"===c.link?e=f:"post"===c.link?e=d.link:"custom"===c.link&&(e=c.linkUrl);""!==e&&(C.push('href="'+e+'"'),s="[url:"+C.length+"]",t="[/url]");X.push('src="'+f+'" width="'+h+'" height="'+k+'" class="'+r+" size-"+c.size+'"'+m+p);b+=g+s+"[img:"+
X.length+"]"+t+q;b+=N.substring(wa);ea.val(b);ea[0].focus()}function jc(a){a.stopPropagation();T.dialog(F)}function kc(){s=!1;hb()}function lc(){s=!1;Ma()}function mc(){0<D&&!r.noHTMLWarn&&(r.noHTMLWarn=!0,xa.dialog(F))}function nc(d){var c,b;if("dopreview"===a("#wp-preview",d.target).val()||0===D)return!0;(d=tinyMCE.activeEditor&&!tinyMCE.activeEditor.isHidden())?c=a("<div>"+P.getContent()+"</div>"):(b=a("#wp-content-editor-container").find("textarea"),c=a("<div>"+b.val()+"</div>"));var f=a(".easyrecipeWrapper",
c);a(".easyrecipeAbove,.easyrecipeBelow",f).remove();a(".easyrecipe",f).unwrap();a(".easyrecipe",c).removeClass("mceNonEditable");c=a.trim(c.html());d?P.setContent(c):b.val(c);return!0}function oc(d){""!=d.target.innerHTML&&(d=a(d.target).find("img").attr("src"))&&La(d,!1)}function pc(d){var c,b;d=d[0];for(c=0;c<d.addedNodes.length;c++)if(b=a(d.addedNodes[c].innerHTML),b=b.find("img").attr("src")){La(b,!1);break}}var Ob=jQuery.trim,P,eb,Za,K,M,ra,sa,y,z,S,I,B,L,R,$a,Ua,Xa=!1,gb,Oa,h,fb,Gb=/\x3c!-- START INCLUDEIF (!?)([_a-z][_0-9a-z]{0,19}) --\x3e/i,
Hb=/^#([_a-z][_0-9a-z]{0,19})#/im,Ib=/\x3c!-- START REPEAT ([_a-zA-Z][_0-9a-zA-Z]{0,19}) --\x3e/m,ub,vb=/^([^<]*)/,Va=/^(?:([0-9]+) *(?:h|hr|hrs|hour|hours))? *(?:([0-9]+) *(?:m|mn|mns|min|mins|minute|minutes))?$/i,Jb=/^([0-9]+)$/,Sb=/(.*)\[amd-(recipeseo|zlrecipe)-recipe:([0-9]+)\](.*)/,Tb=/(.*)\[(yumprint)-recipe\s+id='(\d+)'\](.*)/i,Ub=/(.*)\[(gmc)_recipe\s+([0-9]+)\](.*)/,ab,Ja,Ya,Pa,qb=/PT(?:([0-9]*)+H)?([0-9]+)+M/i,tb=/\[(?:img) +(?:[^\]]+?)\]/ig,Xb=/class\s*=\s*"(?:[^"]+ )?photo[ "]/i,Wb=/src\s*=\s*" *([^"]+?) *"/i,
Vb={recipeseo:"Recipe SEO",ziplist:"ZipList",zlrecipe:"ZipList",yumprint:"Yumprint Recipe Card",recipress:"ReciPress",gmc:"GetMeCooking"},C=[],X=[],fa=[],Ta=[],va,wa,N,Db=0,ea,r,xa,ha='<div class="easyrecipeholder">EasyRecipe</div>',Wa=".easyrecipeholder",wb="ERSeparator",A,T,Q,t=null,Ca,m,za,Qa,Ra,u,G,Ha,Ia,Da,Ea,Fa,Ga,Bb,kb,Cb,lb,Z,$,aa,ia,ja,ka,la,ma,na,oa,pa,qa,ta,U,D=0,Y,Yb=!0,db,cb,H,mb,V,J="close",E="click",Aa="undefined",F="open",ca="ERPhotoSelected",Rb="http://www.easyrecipeplugin.com/checkUpdates.php",
sb='<div class="divERNoPhotos">There are no photos in this post<br />Add photos anywhere in the post</div>',da,ua=-1,Na=-2,x="",Ka,xb="&nbsp;",zb,rb,s,cc=[],O=!1,ya;"use strict";a(function(){var d,c;c=null;r=EASYRECIPE;r.dialogs=a("<div>").addClass("easyrecipeUI").prop("id","er-dialogs").appendTo("body");a.widget("custom.easyrecipeDialog",a.ui.dialog,{_allowInteraction:function(b){return this._super(b)||!!a(b.target).parents(".media-modal-content, #wp-link").length}});r.button!==a.fn.button&&(c=a.fn.button,
a.fn.button=r.button);A=a("#easyrecipeEntry");T=a("#easyrecipeUpgrade");xa=a("#easyrecipeHTMLWarn");I=r.isGuest?"guestpost":"content";A.easyrecipeDialog({autoOpen:!1,width:655,modal:!0,appendTo:r.dialogs,dialogClass:"easyrecipeEntry",beforeClose:function(){if(O){if(!window.confirm("Are you sure you want to close without saving the recipe?"))return!1;O=!1}return!0},close:function(){r.isEntryDialog=!1;h&&!fb&&h.remove();h=!1;a(".easyrecipeEntry").filter(function(){return""===a(this).text()}).remove()},
open:function(){r.isEntryDialog=!0;za.tabs({active:0,beforeActivate:Eb});setTimeout(function(){var b=a(".easyrecipeEntry"),c=b.offset();c.top<mb&&(c.top=mb,b.offset(c))},250)}});ya=a("#divERContainer").show();xa.dialog({autoOpen:!1,width:420,modal:!0,dialogClass:"easyrecipeHTMLWarn",appendTo:r.dialogs,close:function(){a(".easyrecipeHTMLWarn").filter(function(){return""===a(this).text()}).remove()}});a(".divERHTMLWarnContainer").show();T.dialog({autoOpen:!1,width:420,modal:!0,dialogClass:"easyrecipeUpgrade",
appendTo:r.dialogs,close:function(){a(".easyrecipeUpgrade").filter(function(){return""===a(this).text()}).remove()}});a(".divERUPGContainer").show();Q=a("#easyrecipeConvert");Ia=a("#divERCNVSpinner");Da=a("#btnERCNVCancel");Ea=a("#btnERCNVOK");Ia.hide();Q.dialog({autoOpen:!1,width:390,modal:!0,dialogClass:"easyrecipeConvert",appendTo:r.dialogs,close:function(){a(".easyrecipeConvert").filter(function(){return""===a(this).text()}).remove()}});a("#divERCNVContainer").show();a(window).bind("easyrecipeadd",
kc);a(window).bind("easyrecipeedit",lc);a(window).bind("easyrecipeload",dc);Ra=a("#divERNext");Qa=a("#btnERButtons");za=a("#ERDTabs");G=a("#divERPhotos");a("input:submit",".easyrecipeUI").button();a("#ed_toolbar");Za=a("#inpERRating");K=a("#inpERName");B=a("#inpERAuthor");L=a("#inpERType");R=a("#inpERCuisine");$a=a("#inpERTags");M=a("textarea#taERSummary");ra=a("textarea#taERIngredients");sa=a("textarea#taERInstructions");y=a("#inpERPrepTime");z=a("#inpERCookTime");S=a("#inpERYield");Z=a("#inpERServeSize");
$=a("#inpERCalories");aa=a("#inpERFat");ia=a("#inpERSatFat");ja=a("#inpERUnsatFat");ka=a("#inpERTransFat");la=a("#inpERCarbs");ma=a("#inpERSugar");na=a("#inpERSodium");oa=a("#inpERFiber");pa=a("#inpERProtein");qa=a("#inpERCholesterol");ta=a("textarea#taERNotes");db=a("#divERAddImageURL");d=a("#lnkERPhotoURL");Ua=a(".ERTimeError");Fa=a("#divERAdd");Ga=a("#divERChange");a("#divERHeader");Bb=a("#divEROther");kb=a("#divEROtherLabel");Cb=a("#divERNotes");lb=a("#divERNotesLabel");Ha=a("#ERDPasteTab");cb=
a("#fldERAPUImageURL");a("#btnERAdd").click(Ab);a("#btnERNext").click(Fb);a("#btnERChange").click(Ab);a("#btnERDelete").click($b);a("#btnERCancel").click(Zb);d.click(function(){T.dialog(F)});a("#btnERAIUCancel").click(function(){db.hide()});a("#btnERAIUOK").click(Qb);kb.click(ec);lb.click(fc);y.change(function(b){Ba(a(b.target))});z.change(function(b){Ba(a(b.target))});a("#btnERPaste").click(ac);mb=a("#wpadminbar").height();V=a("#divEREditBtns").on("mousedown","li",jc);ya.find('input[type="text"], textarea').on("blur",
function(){}).on("focus",function(){a(this)});a("#wp-link").bind("wpdialogclose",hc);r.insertLink=gc;Ya=hb;Pa=!1;r.insertUploadedImage=ic;zb=bc;rb=ba;r.addListener=jb;xa.find("input").on(E,function(){xa.dialog(J)});a("#wp-content-editor-tools").on(E,"#content-html",mc);a("#post").on("submit",nc);null!==c&&(a.fn.button=c);d=a("#postimagediv").find(".inside");if(window.MutationObserver&&0<d.length)c=new MutationObserver(pc),c.observe(d[0],{childList:!0});else d.on("DOMSubtreeModified",oc);window.QTags&&
QTags.addButton("easyrecipe","EasyRecipe",function(){alert("Switch to the Visual Editor to add or edit an EasyRecipe")},"","","",900)})})(jQuery);
