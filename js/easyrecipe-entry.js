(function(bL){var H=jQuery.trim;var R,S,bA,bT,bx,k,ax,aW,bo,at;var w,bd,bu,aT,bz,N=false,Q,bE,bW,O,f;var bM=/<!-- START INCLUDEIF (!?)([_a-z][_0-9a-z]{0,19}) -->/i;var o=/^#([_a-z][_0-9a-z]{0,19})#/im;var b=/<!-- START REPEAT ([_a-zA-Z][_0-9a-zA-Z]{0,19}) -->/m;var bg=/^([^<]*)/,s=/^(?:([0-9]+) *(?:h|hr|hrs|hour|hours))? *(?:([0-9]+) *(?:m|mn|mns|min|mins|minute|minutes))?$/i,aB=/^([0-9]+)$/;var bV=/(.*)\[amd-(recipeseo|zlrecipe)-recipe:([0-9]+)\](.*)/;var bb,a6,by,bU,V;var au=/PT(?:([0-9]*)+H)?([0-9]+)+M/i;var ak=/\[(?:img) +(?:[^\]]+?)\]/ig;var P=/class\s*=\s*"(?:[^"]+ )?photo[ "]/i;var a1=/(.*)(?:^| )photo(?: |$)(.*)/ig;var am=/class\s*=\s*"([^"]+)"/ig;var bk=/src\s*=\s*" *([^"]+?) *"/i;var bm=[];var br=[];var aF='<input type="button" class="ed_button" value="EasyRecipe" />',E="Use the Visual Editor to add or edit an EasyRecipe";var bh,aK,aQ,ah=null,r=0,n,v,bp;var aM='<div class="easyrecipeholder">EasyRecipe</div>',i=".easyrecipeholder",aL="ERSeparator";var bc,M,F,t,aJ=null,bq,ac,bP,aX="option",aC="zIndex",d,W,a9,bS,aG;var ar,y,bG,bw,bR,bC,L,be,bi,bs,bB;var bl,m,aD,bD,aI,a7,ao,bI,e,B,aY,c,u,bF;var aZ=0,bf=false,a2,J=true,C,az,bJ,X,a4;var l="close",aq="click",aN="undefined",I="open",aS="ERPhotoSelected",af="http://www.easyrecipeplugin.com/checkUpdates.php";var aw='<div class="divERNoPhotos">There are no photos in this post<br />Add photos anywhere in the post</div>';var bj,aE=-1,aA=-2,D="",bn,ai="&nbsp;",ba,ab,G;function al(bY,bZ){W.show();a4.hide();a9.show();switch(bZ.index){case 0:a4.css("right","10px");a4.show();break;case 3:a4.css("right","inherit");a9.hide();a4.show();break;case 4:W.hide();break}}function bH(bY){return bY?bY.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&nbsp;/g," "):""}function x(bY){return bY?bL("<div />").text(bY).html():""}function ay(bY){return bL.trim(x(bY.val()))||false}function a(bZ,b0){var bY=d.tabs("option","selected");d.tabs("option","selected",++bY)}function ag(bZ){var b1,bY=/\[img +(.*?) *\/?\]/i,b0=/\[url ([^\]]+)\](.*?\[\/url\])/i;b1=bY.exec(bZ);while(b1!==null){br.push(b1[1]);bZ=bZ.replace(bY,"[img:"+br.length+"]");b1=bY.exec(bZ)}b1=b0.exec(bZ);while(b1!==null){bm.push(b1[1]);bZ=bZ.replace(b0,"[url:"+bm.length+"]$2");b1=b0.exec(bZ)}return bZ}function g(bZ){var b2,b1,bY=/\[img:(\d+)\]/i,b0=/\[url:(\d+)\](.*?)\[\/url\]/i;b1=bY.exec(bZ);while(b1!==null){b2=br[b1[1]-1];bZ=bZ.replace(bY,"[img "+b2+"]");b1=bY.exec(bZ)}b1=b0.exec(bZ);while(b1!==null){b2=bm[b1[1]-1];bZ=bZ.replace(b0,"[url "+b2+"]$2[/url]");b1=b0.exec(bZ)}return bZ}function aV(cs,ce){var ck=0,cf=1,bY=2,cu;var cl,cc,b5,cb="",ca="",cn,bZ,b2,cm,cp;var co="<!-- START REPEAT ",cw="<!-- START INCLUDEIF ",cv="<!-- END INCLUDEIF ";var b1,b0,b7,cr,ci,b6,cd,cj,ct,b9;var b3,ch,cq;var b8,cg,b4;cu=cs;ce=ce||{};while(true){cn=cu.length;bZ=cu.indexOf("#",cb);if(bZ!==-1){cn=bZ;b2=ck}cm=cu.indexOf(co,cb);if(cm!==-1&&cm<cn){cn=cm;b2=cf}cp=cu.indexOf(cw,cb);if(cp!==-1&&cp<cn){cn=cp;b2=bY}if(cn===cu.length){return ca+cu.substr(cb)}b1=cn-cb;ca+=cu.substr(cb,b1);cb=cn;switch(b2){case bY:cc=cu.substr(cb,44);b5=bM.exec(cc);if(b5!==null){b0=b5[1];b7=b0!=="!";cr=b5[2]}else{break}ci=cv+b0+cr+" -->";b6=ci.length;cd=cu.indexOf(ci);if(cd===-1){cb++;break}cj=typeof ce[cr]!==aN&&ce[cr]!==false;if(cj===b7){ct="<!-- START INCLUDEIF "+b0+cr+" -->";b9=ct.length;cu=cu.substr(0,cb)+cu.substr(cb+b9,cd-cb-b9)+cu.substr(cd+b6)}else{cu=cu.substr(0,cb)+cu.substr(cd+b6)}break;case ck:cc=cu.substr(cb,22);b5=o.exec(cc);if(b5===null){ca+="#";cb++;continue}b3=b5[1];if(ce[b3]!==""&&!ce[b3]){ca+="#"+b3+"#";cb+=b3.length+2;continue}ca+=ce[b3];cb+=b3.length+2;break;case cf:cc=cu.substr(cb,45);b5=b.exec(cc);if(b5===null){ca+="<";cb++;continue}ch=b5[1];if(!ce[ch]||!(ce[ch] instanceof Array)){ca+="<";cb++;continue}cb+=ch.length+22;cq=cu.indexOf("<!-- END REPEAT "+ch+" -->",cb);if(cq===-1){ca+="<!-- START REPEAT "+ch+" -->";continue}b8=cq-cb;cg=cu.substr(cb,b8);b4=ce[ch];for(cl=0;cl<b4.length;cl++){ca+=aV(cg,b4[cl])}cb+=ch.length+b8+20;break}}}function T(b2){var bY=bL.trim(b2.val()),bZ=0,b1=0,b0,b3;bz.hide();if(bY===""){return true}bP=s.exec(bY);if(bP===null){bP=aB.exec(bY);if(bP===null){bz.show();return false}bZ=0;b1=bP[1]}else{bZ=bP[1]?parseInt(bP[1],10):0;b1=bP[2]?parseInt(bP[2],10):0}if(bZ===0&&b1===0){b2.val("")}else{b0=bZ>0?bZ+" hour":"";if(bZ>1){b0+="s"}b3=b1>0?b1+" min":"";if(b1>1){b3+="s"}b2.val(bL.trim(b0+" "+b3))}return true}function p(b2){var bZ,bY,b0,b1="";for(bZ=0;bZ<b2.length;bZ++){bY=b2[bZ];if(bY.nodeType===3){b0=bL.trim(bY.nodeValue);if(b0!==""){b1+=b0+"\n"}continue}if(bY.nodeType!==1){continue}if(bY.childNodes.length>0){b1+=p(bY.childNodes)}}return b1}function bN(){bL(i,aJ).remove();var bZ=tinyMCE.activeEditor;var bY=R.selection.getNode();if(bY.nodeName==="#document"){bY=bq[0]}if(bY.nodeName.toUpperCase()==="BODY"){if(!bL(bY).hasClass("mceContentBody")){bY=bq[0]}bL(bY).append("&nbsp;"+aM)}else{while(bY.parentNode&&bY.parentNode.nodeName.toUpperCase()!=="BODY"){bY=bY.parentNode}if(!bY.parentNode){bY=bq[0];bL(bY).append("&nbsp;"+aM)}else{if(bY.nodeName.toUpperCase()==="DIV"||bY.nodeName.toUpperCase()==="SPAN"){bL(bY,aJ).after(aM)}else{bL(bY,aJ).before(aM)}}}a2=-1;return bL(i,aJ)}function Y(bY,b0,bZ){}function Z(bZ,b0,bY){switch(bZ.type){case"js":bL("head").append(bL('<script type="text/javascript">'+bZ.js+"<\/script>"));v[bZ.f]();break;case"html":bL(bZ.dest).html(bZ.html);break}}function bX(){bG.unbind(aq);bw.unbind(aq);t.dialog(l);N=true;by()}function K(b2,bZ){var b1,bY="",b0=b2.recipe;if(bZ!=="success"){t.dialog(l);N=true;by()}bA.val(bH(b0.recipe_title));D=b0.recipe_image;bd.val("");w.val("");bu.val("");aT.val("");bT.val(bH(b0.summary));bP=au.exec(b0.prep_time);if(bP!==null){b1=bP[1]?bP[1]+"h ":"";ax.val(b1+bP[2]+"m")}else{ax.val(bH(b0.prep_time))}bP=au.exec(b0.cook_time);if(bP!==null){b1=bP[1]?bP[1]+"h ":"";aW.val(b1+bP[2]+"m")}else{aW.val(bH(b0.cook_time))}bo.val(bH(b0.yield));m.val(bH(b0.calories));aD.val(bH(b0.fat));bl.val(bH(b0.serving_size));for(b1=0;b1<b2.ingredients.length;b1++){bY+=H(bH(b2.ingredients[b1]))+"\n"}bx.val(bY);k.val(bH(b0.instructions.replace("\r","")));u.val(bH(b0.notes));bc.dialog("option","title","Update Recipe");t.dialog(l);bR.hide();bC.show();ar.hide();if(D!==""){ab(D,bS.length,true)}bW=bN();bc.dialog(aX,aC,ac);bc.dialog(I)}function a0(){y.show();bG.unbind(aq);bw.unbind(aq);var bY={action:"easyrecipeConvert",id:bb,type:a6};bL.post(ajaxurl,bY,K,"json")}function z(b8){var b7,ch,b9,b3=0,cd,b2="",bY="",bZ="",b5="";var b6=["instruction","method","cooking method","procedure"];var ci=["ingredients?"];var b0=["note","cooking note"];var cj="";var ce="";var b1="";var cf,ca,cc;var cg,b4,cb;cg=bL.parseJSON(v.ingredients);b4=bL.parseJSON(v.instructions);cb=bL.parseJSON(v.notes);if(bL.inArray(cg,ci)===-1){ci.push(cg)}ce="^\\s*(?:"+ci.join("|")+")";ca=new RegExp(ce,"i");if(bL.inArray(b4,b6)===-1){ci.push(b4)}cj="^\\s*(?:"+b6.join("|")+")";cf=new RegExp(cj,"i");if(bL.inArray(cb,b0)===-1){b0.push(cb)}b1="^\\s*(?:"+b0.join("|")+")\\s*$";cc=new RegExp(b1,"i");cd=bL("<div>"+b8+"</div>");b7=p(cd[0].childNodes);b7=b7.split("\n");for(ch=0;ch<b7.length;ch++){b9=bL.trim(b7[ch]);if(b9===""){continue}if(cf.test(b9)){b3=2;continue}if(ca.test(b9)){b3=1;continue}if(cc.test(b9)){b3=3;continue}switch(b3){case 0:b2+=b9+"\n";break;case 1:bY+=b9+"\n";break;case 2:bZ+=b9+"\n";break;case 3:b5+=b9+"\n";break}}return{summary:b2,ingredients:bY,instructions:bZ,notes:b5}}function av(){M.dialog(aX,aC,ac);M.dialog(I)}function aa(b1,bY,bZ){var b2=function(){var b3,b7,b6,b4,b5=bL.data(this,"index");b3=this.width/150;b7=this.height/112;b3=b3>b7?b3:b7;b6=Math.floor(this.height/b3);b4=Math.floor(this.width/b3);bS[b5].height(b6);bS[b5].width(b4);bS[b5].css("top",(112-b6)/2);bS[b5].attr("src",this.src);if(b5===0){bL("#ERDTabs .divERNoPhotos").remove()}};aG.append('<div class="ERPhoto"><img style="position:relative" id="ERPhoto_'+bY+'" /></div>');bS[bY]=bL("#ERPhoto_"+bY,aG);bS[bY].data("src",b1);if(bZ){bL(".ERPhoto",aG).removeClass(aS);bS[bY].parent().addClass(aS);bJ=bY;D=b1}if(bn===""){bn=b1}var b0=new Image();bL.data(b0,"index",bY);b0.onload=b2;b0.src=b1}function ae(){aa(az.val(),bS.length,true);az.val("");C.hide();bL(".divERNoPhotos").remove()}function ad(cd,cg){var ch,bY,cc,cb,b7,b6,b8,b9,ci;var b1={},b5="",bZ="",b0="",ca="",cf;if(cg===aE&&aZ!==0){av();return}if(cd&&cd.data===aA){cg=aA;cd=cd.delegateTarget}if(typeof cg===aN&&typeof cd===aN){a2=0}aZ=1;a2=0;bW=bL(".easyrecipe:first",aJ);if(cg!==aE&&bW.length>1){bW=bL(bW[cg]);a2=cg}b8=bL.support.cors?"json":"jsonp";bL.ajax(af,{dataType:b8,data:{v:v.version},success:Z,error:Y});S=false;if(typeof tinyMCE!==aN){if(tinyMCE.activeEditor&&!tinyMCE.activeEditor.isHidden()){S=true}}if(!S){alert("You must use the Visual Editor to add or update an EasyRecipe");return}bA.val("");bd.val("");bu.val("");aT.val("");w.val("");bT.val("");ax.val("");aW.val("");bo.val("");bx.val("");k.val("");bl.val("");m.val("");aD.val("");bD.val("");aI.val("");a7.val("");ao.val("");bI.val("");e.val("");B.val("");aY.val("");c.val("");u.val("");if(cg!==aE&&bW.length===1){bc.dialog("option","title","Update Recipe");ar.hide();bR.hide();bC.show();O=true}else{bE=R.getContent();if(!N){b7=bV.exec(bE);if(b7){a6=b7[2];bb=b7[3];y.hide();bG.click(bX);bw.click(a0);var b2=a6==="recipeseo"?"RecipeSEO":"ZipList";cb=bL("#txtERCNVText1",t);cb.html(cb.html().replace("#plugin#",b2));aG.html("");bJ=-1;bS=[];aG.html(aw);t.dialog(aX,aC,ac);t.dialog(I);return}}if(v.isGuest){w.val(bL("#inpERAuthor").val())}bR.show();bC.hide();ar.show();bc.dialog("option","title","Add a New Recipe");O=false;if(V!==false){b1=z(V)}else{cf=R.selection.getContent();if(cf.length>20){b1=z(cf)}}if(b1.summary){b5=b1.summary}if(b1.ingredients){bZ=b1.ingredients}if(b1.instructions){b0=b1.instructions}if(b1.notes){ca=b1.notes}bW=bN()}bL("#inpERCuisine").autocomplete({source:bL.parseJSON(v.cuisines)}).autocomplete("widget").wrap('<div class="easyrecipeUI" />');bL("#inpERType").autocomplete({source:bL.parseJSON(v.recipeTypes)}).autocomplete("widget").wrap('<div class="easyrecipeUI" />');Q=false;if(bL(".hrecipe",aJ).length>0){if(confirm("This post is already hrecipe microformatted\n\nDo you want me to try to convert it to an EasyRecipe?")){Q=true}}bj=(cg!==aE)?bW.find(".endeasyrecipe").text():v.version;if(bj===""){bj="2.2"}D=bL('link[itemprop="image"]',bW).attr("href")||"";aG.html("");bJ=-1;bn="";bS=[];aJ.find("img").each(function(cj){var ck=false;if(bj<"3"){if(bL(this).hasClass("photo")){ck=true}}else{ck=this.src===D}aa(this.src,cj,ck)});var ce=aJ.contents().text();b7=ak.exec(ce);b9=bS.length;while(b7!==null){var b4,b3=bk.exec(b7[0]);if(b3!==null){b4=b3[1];aa(b4,b9);if(bj>"3"){if(D===b4){bS[b9].parent().addClass(aS);bJ=b9}}else{if(P.test(b7[0])){bS[b9].parent().addClass(aS);bJ=b9;D=b4}}b9++}b7=ak.exec(ce)}if(D!==""){bY=false;for(ch=0;ch<bS.length;ch++){if(bS[ch].data("src")===D){bY=true;break}}if(!bY){aa(D,bS.length,true)}}if(bJ===-1&&bS.length>0){bJ=0;D=bn;bS[0].parent().addClass(aS)}aG.click(function(cj){M.dialog(aX,aC,ac);M.dialog(I)});if(bS.length===0){aG.html(aw)}else{if(bJ===-1){bS[0].parent().addClass(aS)}}br=[];bm=[];ci=bW.find(".ERName .fn").html()||bW.find(".ERName").html();if(!ci||ci===""){bA.val(ag(bH(bL("#title").val())))}else{bA.val(ag((bH(ci))))}bd.val(ag(bH(bW.find(".type").html())));w.val(ag(bH(bW.find(".author").html())));if(w.val()===""){w.val(ag(bL.parseJSON(v.author)))}bu.val(ag(bH(bW.find(".cuisine").html())));bT.val(ag(b5+bH(bW.find(".summary").html())));if(bj>"3"){b6=bW.find('time[itemprop="prepTime"]').html()||"";ax.val(bH(b6));b6=bW.find('time[itemprop="cookTime"]').html()||"";aW.val(bH(b6))}else{b6=bW.find(".preptime").html()||"";b7=bg.exec(b6);if(b7!==null){ax.val(bH(b7[1]))}else{ax.val("")}b6=bW.find(".cooktime").html()||"";b7=bg.exec(b6);if(b7!==null){aW.val(bH(b7[1]))}else{aW.val("")}}bo.val(bH(bW.find(".yield").html()));bW.find(".ingredients li").each(function(ck,cj){if(bL(cj).hasClass(aL)){bZ+="!"+ag(bH(cj.innerHTML))+"\n"}else{bZ+=ag(bH(cj.innerHTML))+"\n"}});bx.val(bZ);bW.find(".instructions li, .instructions .ERSeparator").each(function(ck,cj){cc=bL.trim(cj.innerHTML.replace(/^[ 0-9.]*(.*)$/ig,"$1"));if(bL(cj).hasClass(aL)){b0+="!"+cc+"\n"}else{b0+=cc+"\n"}});k.val(ag(bH(b0)));bl.val(bH(bW.find(".servingSize").html()));m.val(bH(bW.find(".calories").html()));aD.val(bH(bW.find(".fat").html()));bD.val(bH(bW.find(".saturatedFat").html()));aI.val(bH(bW.find(".unsaturatedFat").html()));a7.val(bH(bW.find(".transFat").html()));ao.val(bH(bW.find(".carbohydrates").html()));bI.val(bH(bW.find(".sugar").html()));e.val(bH(bW.find(".sodium").html()));B.val(bH(bW.find(".fiber").html()));aY.val(bH(bW.find(".protein").html()));c.val(bH(bW.find(".cholesterol").html()));cc=(bW.find(".ERNotes").html()||"").replace(/<\/p>\n*<p>/ig,"\n\n").replace(/(?:<p>|<\/p>)/ig,"").replace(/<br *\/?>/ig,"\n");if(cc===""&&ca!==""){cc=ca}u.val(ag(cc));if(G){if(G.name){bA.val(ag((bH(G.name))))}if(G.author){w.val(ag(G.author))}if(G.summary){bT.val(ag(G.summary))}if(G.yield){bo.val(bH(G.yield))}if(G.type){bd.val(ag(bH(G.type)))}if(G.cuisine){bu.val(ag(bH(G.cuisine)))}if(G.prepTime){ax.val(bH(G.prepTime))}if(G.cookTime){aW.val(bH(G.cookTime))}if(G.summary){bT.val(ag(G.summary))}}bc.dialog(aX,aC,ac);bc.dialog(I);bc.dialog("option","position","center")}function A(bY){aZ=bL(".easyrecipe",aJ).length;if(J||aZ===0){ad(bY,aE);return}M.dialog(aX,aC,ac);M.dialog(I)}function a5(){bc.dialog(l)}function q(){var bY=confirm("Are you sure you want to delete this recipe?");if(bY){bW.remove();bW=false}bc.dialog(l)}function aj(){var bY,bZ=bL("#inpERPaste").val();bY=z(bZ);if(bY.ingredients.length===0&&bY.instructions.length===0){return}V=bZ;bL("#inpERPaste").val("");G={name:g(x(bA.val())),author:g((ay(w))),yield:ay(bo),type:g((ay(bd))),cuisine:g((ay(bu))),summary:g(ay(bT)),servesize:ay(bl),prepTime:ax.val(),cookTime:aW.val()};bc.dialog(l);A(null)}function bK(b0){var bZ=bL(b0.target).parent();var b1=bZ.parent();if(bZ.hasClass("easyrecipeAbove")){b1.before(ai)}else{b1.after(ai)}bL(".easyrecipeAbove,.easyrecipeBelow",b1).remove();var bY=bL(".easyrecipe",b1).unwrap();ba(bY)}function bO(b2){var bZ,bY,b1,b0;b1=b2.prev();b0=b2.next();bZ=(b1.length===0||b1.hasClass("easyrecipe")||b1.hasClass("easyrecipeWrapper"));if(bZ){bZ=!(b2[0].previousSibling&&b2[0].previousSibling.nodeType===3)}bY=(b0.length===0||b0.hasClass("easyrecipe")||b0.hasClass("easyrecipeWrapper"));if(bY){bY=!(b2[0].nextSibling&&b2[0].nextSibling.nodeType===3)}if(!bZ&&!bY){return}b2.wrap('<div class="easyrecipeWrapper" />');if(bZ){b2.parent().prepend('<div class="easyrecipeAbove"><input class="ERInsertLine" type="button" value="Insert line above" /></div>')}if(bY){b2.parent().append('<div class="easyrecipeBelow"><input class="ERInsertLine" type="button" value="Insert line below" /></div>')}bL(".easyrecipeWrapper .ERInsertLine",aJ).on(aq,bK)}function h(bY){bL(".easyrecipeAbove,.easyrecipeBelow",bY).remove();bL(".easyrecipe",bY).unwrap()}function bv(){var bY=bL(".easyrecipe",aJ);if(bY.length===0){return}bY.on("mousedown",null,aA,ad);h(bL(".easyrecipeWrapper",aJ));bY.each(function(){bO(bL(this))})}function aU(){var ca,b4="",b1,b9="",bY=0,ce="";var cg,cc,b8,b2,cf,b5,cb,bZ=[],b3;if(!T(ax)){return}if(!T(aW)){return}b1=bL.trim(ax.val());if(b1!==""){bP=s.exec(b1);cg=bP[1]?parseInt(bP[1],10):0;cc=bP[2]?parseInt(bP[2],10):0;bY=cg*60+cc;b8=cg>0?cg+"H":"";b2=cc>0?cc+"M":"";b9="PT"+b8+b2}else{b1=false}ca=bL.trim(aW.val());if(ca!==""){bP=s.exec(ca);cg=bP[1]?parseInt(bP[1],10):0;cc=bP[2]?parseInt(bP[2],10):0;b8=cg>0?cg+"H":"";b2=cc>0?cc+"M":"";bY+=cg*60+cc;b4="PT"+b8+b2}else{ca=false}if(bY>0){cg=Math.floor(bY/60);cc=bY%60;b8=cg>0?cg+" hour":"";if(cg>1){b8+="s"}b2=cc>0?cc+" min":"";if(cc>1){b2+="s"}bY=bL.trim(b8+" "+b2);b8=cg>0?cg+"H":"";b2=cc>0?cc+"M":"";ce="PT"+b8+b2}else{bY=false}cf=bx.val().split("\n");for(cb=0;cb<cf.length;cb++){b5=cf[cb];if(b5!==""){if(b5.charAt(0)==="!"){b3=true;b5=b5.substr(1)}else{b3=false}bZ.push({ingredient:g(x(b5)),hasHeading:b3})}}cf=k.val().split("\n");var cd=[];var b0={INSTRUCTIONS:[]};for(cb=0;cb<cf.length;cb++){b5=bL.trim(cf[cb].replace(/^[ 0-9\.]*(.*)$/ig,"$1"));if(b5!==""){if(b5.charAt(0)==="!"){if(b0.INSTRUCTIONS.length>0||b0.heading){cd.push(b0)}b5=b5.substr(1);b0={};b0.INSTRUCTIONS=[];b0.heading=x(b5)}else{b0.INSTRUCTIONS.push({instruction:g(x(b5))})}}}if(b0.INSTRUCTIONS.length>0||b0.heading){cd.push(b0)}b5=ay(u);if(b5){b5="<p>"+b5.replace(/\n\n/ig,"</p><p>").replace(/\n/ig,"<br />")+"</p>"}var b7={version:v.version,hasPhoto:D!=="",photoURL:D,name:g(x(bA.val())),author:g((ay(w))),preptime:b1,cooktime:ca,totaltime:bY,preptimeISO:b9,cooktimeISO:b4,totaltimeISO:ce,yield:ay(bo),type:g((ay(bd))),cuisine:g((ay(bu))),summary:g(ay(bT)),servesize:ay(bl),calories:ay(m),fat:ay(aD),satfat:ay(bD),unsatfat:ay(aI),transfat:ay(a7),carbs:ay(ao),sugar:ay(bI),sodium:ay(e),fiber:ay(B),protein:ay(aY),cholesterol:ay(c),notes:g(b5),INGREDIENTS:bZ,STEPS:cd};var b6=aV(v.recipeTemplate,b7);if(Q){bL(".hrecipe",aJ).remove()}if(a2===-1){bW=bL(i,aJ)}else{bW=bL(".easyrecipe",aJ);if(bW.length>0){bW=bL(bW[a2])}}bW.before(b6);bW.remove();bW=false;bF.show();bc.dialog(l);aZ=bL(".easyrecipe",aJ).length;bv()}function bt(b1,bY,b2){G=false;if(bY.editorId!==at&&bY.editorId!=="wp_mce_fullscreen"){bL("#"+bY.editorId+"_easyrecipeTest").hide();bL("#"+bY.editorId+"_easyrecipeEdit").hide();bL("#"+bY.editorId+"_easyrecipeAdd").hide();return}var bZ;if(bY.editorId===at){aJ=bL("#"+at+"_ifr").contents();ac=10000;bZ=bL("#"+at+"_easyrecipeTest");bF=bL("#"+at+"_easyrecipeEdit")}else{aJ=bL("#wp_mce_fullscreen_ifr").contents();ac=200001;bZ=bL("#mce_fullscreen_easyrecipeTest");bF=bL("#mce_fullscreen_easyrecipeEdit")}bq=bL("body",aJ);var b0=bL(".easyrecipe",aJ);R=tinyMCE.activeEditor;b0.each(function(){bL(this).addClass("mceNonEditable");bL(".ERRatingOuter",this).remove();bL(".ERHDPrint",this).remove();bL(".ERLinkback",this).remove()});aZ=b0.length;if(aZ>0&&v.testURL!==""){bZ.show()}else{bZ.hide()}if(aZ>0){bF.show()}else{bF.hide()}if(!aJ.hasERCSS){bL("head",aJ).append('<link rel="stylesheet" type="text/css" href="'+v.easyrecipeURL+'/css/easyrecipe-entry.css" />');aJ.hasERCSS=true}bv()}function aR(){be.toggleClass("ERNone");bi.toggleClass("ERContract")}function a8(){bs.toggleClass("ERNone");bB.toggleClass("ERContract")}function aO(){if(window.getSelection){return window.getSelection()}if(document.getSelection){return document.getSelection()}if(document.selection){return document.selection.createRange().text}return null}function U(b2,b0){var b3,bZ,b1,bY=/(?:<a( .*?")>)?<img( (?:.*?)?src="([^"]*?)"(?:.*)) \/>/i;bZ=bY.exec(b0);b3=bL("#ertmp_"+r,aJ);if(bZ!==null){aa(bZ[3],bS.length);b1=aQ.substring(0,bh);if(!bZ[1]){br.push(bZ[2]);b1+="[img:"+br.length+"]"}else{bm.push(bZ[1]);br.push(bZ[2]);b1+="[url:"+bm.length+"][img:"+br.length+"][/url]"}b1+=aQ.substring(aK);n.val(b1)}n[0].focus();b3.remove()}function j(b1){var bY,bZ,b0,b3,b2;if(!v.isEntryDialog){return}bY=bL("#ertmp_"+r,aJ);if(typeof b1==="string"){b0=bL(b1)}else{b0=bL(bY.html())}if(b0.is("a")){bZ=b0.attr("href");b3=b0.attr("title");b2=b0.attr("target");b3=b3?' title="'+b3+'"':"";b2=b2?' target="'+b2+'"':"";b1='href="'+bZ+'"'+b2+b3;bm.push(b1);n.val(aQ.substring(0,bh)+"[url:"+bm.length+"]"+aQ.substring(bh,aK)+"[/url]"+aQ.substring(aK))}n[0].focus();bY.remove()}function an(){av()}function ap(){G=false;A()}function aP(){G=false;ad()}function a3(bY){if(aZ>0&&bf){bf=true;bp.dialog(aX,aC,ac);bp.dialog(I)}}function aH(b3){var b0,b1,b2,bZ;var bY=bL("#wp-preview",b3.target).val();if(bY==="dopreview"){return}if(aZ===0){return}b2=tinyMCE.activeEditor&&!tinyMCE.activeEditor.isHidden();if(b2){b1=bL("<div>"+R.getContent()+"</div>")}else{bZ=bL("#wp-content-editor-container textarea");b1=bL("<div>"+bZ.val()+"</div>")}h(bL(".easyrecipeWrapper",b1));bL(".easyrecipe",b1).removeClass("mceNonEditable");b0=bL.trim(b1.html());if(b2){R.setContent(b0)}else{bZ.val(b0)}return true}function bQ(){bc=bL("#easyrecipeEntry");M=bL("#easyrecipeUpgrade");bp=bL("#easyrecipeHTMLWarn");v=EASYRECIPE;at=v.isGuest?"guestpost":"content";bc.dialog({autoOpen:false,width:655,modal:true,dialogClass:"easyrecipeEntry",close:function(){v.isEntryDialog=false;if(bW&&!O){bW.remove()}bW=false;bL(".easyrecipeEntry").filter(function(){return bL(this).text()===""}).remove()},open:function(bZ,b0){v.isEntryDialog=true;var bY=bL(".easyrecipeEntry").offset();bL(".ui-widget-overlay").wrap('<div class="easyrecipeUI" />');d.tabs({selected:0,select:al});setTimeout(function(){var b1=bL(".easyrecipeEntry");var b2=b1.offset();if(b2.top<X){b2.top=X;b1.offset(b2)}},250)}});bc.parent(".ui-dialog").wrap('<div class="easyrecipeUI" />');bL("#divERContainer").show();bp.dialog({autoOpen:false,width:420,modal:true,dialogClass:"easyrecipeHTMLWarn",close:function(){bL(".easyrecipeHTMLWarn").filter(function(){return bL(this).text()===""}).remove()},open:function(bY,bZ){bL(".ui-widget-overlay").wrap('<div class="easyrecipeUI" />')}});bp.parent(".ui-dialog").wrap('<div class="easyrecipeUI" />');bL(".divERHTMLWarnContainer").show();M.dialog({autoOpen:false,width:420,modal:true,dialogClass:"easyrecipeUpgrade",close:function(){bL(".easyrecipeUpgrade").filter(function(){return bL(this).text()===""}).remove()},open:function(bY,bZ){bL(".ui-widget-overlay").wrap('<div class="easyrecipeUI" />')}});M.parent(".ui-dialog").wrap('<div class="easyrecipeUI" />');bL(".divERUPGContainer").show();t=bL("#easyrecipeConvert");y=bL("#divERCNVSpinner");bG=bL("#btnERCNVCancel");bw=bL("#btnERCNVOK");y.hide();t.dialog({autoOpen:false,width:390,modal:true,dialogClass:"easyrecipeConvert",close:function(){bL(".easyrecipeConvert").filter(function(){return bL(this).text()===""}).remove()},open:function(bY,bZ){bL(".ui-widget-overlay").wrap('<div class="easyrecipeUI" />')}});bL("#divERCNVContainer").show();t.parent(".ui-dialog").wrap('<div class="easyrecipeUI" />');bL(window).bind("easyrecipeadd",ap);bL(window).bind("easyrecipeedit",aP);bL(window).bind("easyrecipeload",bt);bL(window).bind("easyrecipeimage",U);bL(window).bind("easyrecipeguestimageuploaded",U);a9=bL("#divERNext");W=bL("#btnERButtons");d=bL("#ERDTabs");aG=bL("#divERPhotos");bL("input:submit",".easyrecipeUI").button();f=bL("#ed_toolbar");bA=bL("#inpERName");w=bL("#inpERAuthor");bd=bL("#inpERType");bu=bL("#inpERCuisine");aT=bL("#inpERTags");bT=bL("textarea#taERSummary");bx=bL("textarea#taERIngredients");k=bL("textarea#taERInstructions");ax=bL("#inpERPrepTime");aW=bL("#inpERCookTime");bo=bL("#inpERYield");bl=bL("#inpERServeSize");m=bL("#inpERCalories");aD=bL("#inpERFat");bD=bL("#inpERSatFat");aI=bL("#inpERUnsatFat");a7=bL("#inpERTransFat");ao=bL("#inpERCarbs");bI=bL("#inpERSugar");e=bL("#inpERSodium");B=bL("#inpERFiber");aY=bL("#inpERProtein");c=bL("#inpERCholesterol");u=bL("textarea#taERNotes");C=bL("#divERAddImageURL");bz=bL(".ERTimeError");bR=bL("#divERAdd");bC=bL("#divERChange");L=bL("#divERHeader");be=bL("#divEROther");bi=bL("#divEROtherLabel");bs=bL("#divERNotes");bB=bL("#divERNotesLabel");ar=bL("#ERDPasteTab");az=bL("#fldERAPUImageURL");bL("#btnERAdd").click(aU);bL("#btnERNext").click(a);bL("#btnERChange").click(aU);bL("#btnERDelete").click(q);bL("#btnERCancel").click(a5);bL("#lnkERPhotoURL").click(function(){M.dialog(aX,aC,ac);M.dialog(I)});bL("#btnERAIUCancel").click(function(){C.hide()});bL("#btnERAIUOK").click(ae);bi.click(aR);bB.click(a8);bL("#inpERPrepTime").change(function(bY){T(bL(bY.target))});bL("#inpERCookTime").change(function(bY){T(bL(bY.target))});bL("#btnERPaste").click(aj);X=bL("#wpadminbar").height();a4=bL("#divEREditBtns").on("mousedown","#divEREditBtns li",an);bL('#divERContainer input[type="text"], #divERContainer textarea').on("blur",function(){ah=null}).on("focus",function(){ah=bL(this)});bL("#wp-link").bind("wpdialogclose",j);by=A;bU=ad;V=false;v.insertLink=j;v.insertUploadedImage=U;ba=bO;ab=aa;bL("#easyrecipeHTMLWarn input").on(aq,function(){bp.dialog(l)});bL("#wp-content-editor-tools").on(aq,"#content-html",a3);bL("#post").on("submit",aH)}bL(bQ)}(jQuery));