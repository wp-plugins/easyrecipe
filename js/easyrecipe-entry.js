if(typeof EASYRECIPE==="undefined"){var EASYRECIPE={}}if(!EASYRECIPE.widget){EASYRECIPE.widget=jQuery.widget}if(!EASYRECIPE.button){EASYRECIPE.button=jQuery.fn.button}(function(bI){var G=jQuery.trim;var Q,R,bx,bP,bu,k,av,aV,bl,aq;var w,bb,br,aS,bw,M=false,P,bB,bT,N,f;var bJ=/<!-- START INCLUDEIF (!?)([_a-z][_0-9a-z]{0,19}) -->/i;var o=/^#([_a-z][_0-9a-z]{0,19})#/im;var b=/<!-- START REPEAT ([_a-zA-Z][_0-9a-zA-Z]{0,19}) -->/m;var bd=/^([^<]*)/,s=/^(?:([0-9]+) *(?:h|hr|hrs|hour|hours))? *(?:([0-9]+) *(?:m|mn|mns|min|mins|minute|minutes))?$/i,az=/^([0-9]+)$/;var bS=/(.*)\[amd-(recipeseo|zlrecipe)-recipe:([0-9]+)\](.*)/;var aD=/(.*)\[(yumprint)-recipe\s+id='(\d+)'\](.*)/i;var aL=/(.*)\[(gmc)_recipe\s+([0-9]+)\](.*)/;var a9,a3,bv,bR,U;var ar=/PT(?:([0-9]*)+H)?([0-9]+)+M/i;var aj=/\[(?:img) +(?:[^\]]+?)\]/ig;var O=/class\s*=\s*"(?:[^"]+ )?photo[ "]/i;var bh=/src\s*=\s*" *([^"]+?) *"/i;var bU={recipeseo:"Recipe SEO",ziplist:"ZipList",yumprint:"Yumprint Recipe Card",recipress:"ReciPress",gmc:"GetMeCooking"};var bj=[];var bo=[];var be,aI,aP,ag=null,r=0,n,v,bm;var aK='<div class="easyrecipeholder">EasyRecipe</div>',i=".easyrecipeholder",aJ="ERSeparator";var ba,L,E,t,aH=null,bn,ab,bM,aW="option",aA="zIndex",d,V,a7,bO,aE;var ap,y,bD,bt,bN,bz,K,bc,bf,bp,by;var bi,m,aB,bA,aG,a5,am,bF,e,B,aX,c,u,bC;var aY=0,bQ=false,a0,I=true,C,ax,bG,W,a2;var l="close",ao="click",aM="undefined",H="open",aR="ERPhotoSelected",ae="http://www.easyrecipeplugin.com/checkUpdates.php";var au='<div class="divERNoPhotos">There are no photos in this post<br />Add photos anywhere in the post</div>';var bg,aC=-1,ay=-2,D="",bk,ah="&nbsp;",a8,aa,F;function ak(bW,bX){V.show();a2.hide();a7.show();switch(bX.index){case 0:a2.css("right","10px");a2.show();break;case 3:a2.css("right","inherit");a7.hide();a2.show();break;case 4:V.hide();break}}function bE(bW){if(!bW){return""}bW+="";return bW.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&nbsp;/g," ")}function x(bW){return bW?bI("<div />").text(bW).html():""}function aw(bW){return bI.trim(x(bW.val()))||false}function a(bX,bY){var bW=d.tabs("option","selected");d.tabs("option","selected",++bW)}function af(bX){var bZ,bW=/\[img +(.*?) *\/?\]/i,bY=/\[url ([^\]]+)\](.*?\[\/url\])/i;bZ=bW.exec(bX);while(bZ!==null){bo.push(bZ[1]);bX=bX.replace(bW,"[img:"+bo.length+"]");bZ=bW.exec(bX)}bZ=bY.exec(bX);while(bZ!==null){bj.push(bZ[1]);bX=bX.replace(bY,"[url:"+bj.length+"]$2");bZ=bY.exec(bX)}return bX}function g(bX){var b0,bZ,bW=/\[img:(\d+)\]/i,bY=/\[url:(\d+)\](.*?)\[\/url\]/i;bZ=bW.exec(bX);while(bZ!==null){b0=bo[bZ[1]-1];bX=bX.replace(bW,"[img "+b0+"]");bZ=bW.exec(bX)}bZ=bY.exec(bX);while(bZ!==null){b0=bj[bZ[1]-1];bX=bX.replace(bY,"[url "+b0+"]$2[/url]");bZ=bY.exec(bX)}return bX}function aU(cq,cc){var ci=0,cd=1,bW=2,cs;var cj,ca,b3,b9=0,b8="",cl,bX,b0,ck,cn;var cm="<!-- START REPEAT ",cu="<!-- START INCLUDEIF ",ct="<!-- END INCLUDEIF ";var bZ,bY,b5,cp,cg,b4,cb,ch,cr,b7;var b1,cf,co;var b6,ce,b2;cs=cq;cc=cc||{};while(true){cl=cs.length;bX=cs.indexOf("#",b9);if(bX!==-1){cl=bX;b0=ci}ck=cs.indexOf(cm,b9);if(ck!==-1&&ck<cl){cl=ck;b0=cd}cn=cs.indexOf(cu,b9);if(cn!==-1&&cn<cl){cl=cn;b0=bW}if(cl===cs.length){return b8+cs.substr(b9)}bZ=cl-b9;b8+=cs.substr(b9,bZ);b9=cl;switch(b0){case bW:ca=cs.substr(b9,44);b3=bJ.exec(ca);if(b3!==null){bY=b3[1];b5=bY!=="!";cp=b3[2]}else{break}cg=ct+bY+cp+" -->";b4=cg.length;cb=cs.indexOf(cg);if(cb===-1){b9++;break}ch=typeof cc[cp]!==aM&&cc[cp]!==false;if(ch===b5){cr="<!-- START INCLUDEIF "+bY+cp+" -->";b7=cr.length;cs=cs.substr(0,b9)+cs.substr(b9+b7,cb-b9-b7)+cs.substr(cb+b4)}else{cs=cs.substr(0,b9)+cs.substr(cb+b4)}break;case ci:ca=cs.substr(b9,22);b3=o.exec(ca);if(b3===null){b8+="#";b9++;continue}b1=b3[1];if(cc[b1]!==""&&!cc[b1]){b8+="#"+b1+"#";b9+=b1.length+2;continue}b8+=cc[b1];b9+=b1.length+2;break;case cd:ca=cs.substr(b9,45);b3=b.exec(ca);if(b3===null){b8+="<";b9++;continue}cf=b3[1];if(!cc[cf]||!(cc[cf] instanceof Array)){b8+="<";b9++;continue}b9+=cf.length+22;co=cs.indexOf("<!-- END REPEAT "+cf+" -->",b9);if(co===-1){b8+="<!-- START REPEAT "+cf+" -->";continue}b6=co-b9;ce=cs.substr(b9,b6);b2=cc[cf];for(cj=0;cj<b2.length;cj++){b8+=aU(ce,b2[cj])}b9+=cf.length+b6+20;break}}}function S(b0){var bW=bI.trim(b0.val()),bX=0,bZ=0,bY,b1;bw.hide();if(bW===""){return true}bM=s.exec(bW);if(bM===null){bM=az.exec(bW);if(bM===null){bw.show();return false}bX=0;bZ=bM[1]}else{bX=bM[1]?parseInt(bM[1],10):0;bZ=bM[2]?parseInt(bM[2],10):0}if(bX===0&&bZ===0){b0.val("")}else{bY=bX>0?bX+" hour":"";if(bX>1){bY+="s"}b1=bZ>0?bZ+" min":"";if(bZ>1){b1+="s"}b0.val(bI.trim(bY+" "+b1))}return true}function p(b0){var bX,bW,bY,bZ="";for(bX=0;bX<b0.length;bX++){bW=b0[bX];if(bW.nodeType===3){bY=bI.trim(bW.nodeValue);if(bY!==""){bZ+=bY+"\n"}continue}if(bW.nodeType!==1){continue}if(bW.childNodes.length>0){bZ+=p(bW.childNodes)}}return bZ}function bK(){var bW;bI(i,aH).remove();bW=Q.selection.getNode();if(bW.nodeName==="#document"){bW=bn[0]}if(bW.nodeName.toUpperCase()==="BODY"){if(!bI(bW).hasClass("mceContentBody")){bW=bn[0]}bI(bW).append("&nbsp;"+aK)}else{while(bW.parentNode&&bW.parentNode.nodeName.toUpperCase()!=="BODY"){bW=bW.parentNode}if(!bW.parentNode){bW=bn[0];bI(bW).append("&nbsp;"+aK)}else{if(bW.nodeName.toUpperCase()==="DIV"||bW.nodeName.toUpperCase()==="SPAN"){bI(bW,aH).after(aK)}else{bI(bW,aH).before(aK)}}}a0=-1;return bI(i,aH)}function X(bW,bY,bX){}function Y(bW){switch(bW.type){case"js":bI("head").append(bI('<script type="text/javascript">'+bW.js+"<\/script>"));v[bW.f]();break;case"html":bI(bW.dest).html(bW.html);break}}function bV(){bD.unbind(ao);bt.unbind(ao);t.dialog(l);M=true;bv()}function J(b1,bX){var b0,bW="";var bZ,bY;bZ=b1.recipe;if(bX!=="success"){t.dialog(l);M=true;bv()}bx.val(bE(bZ.recipe_title));D=bZ.recipe_image;bb.val("");if(bZ.author){w.val(bE(bZ.author))}else{w.val("")}br.val(bZ.cuisine||"");bb.val(bZ.mealType||"");aS.val("");bP.val(bE(bZ.summary));bM=ar.exec(bZ.prep_time);if(bM!==null){b0=bM[1]?bM[1]+"h ":"";av.val(b0+bM[2]+"m")}else{av.val(bE(bZ.prep_time))}bM=ar.exec(bZ.cook_time);if(bM!==null){b0=bM[1]?bM[1]+"h ":"";aV.val(b0+bM[2]+"m")}else{aV.val(bE(bZ.cook_time))}bl.val(bE(bZ.yield));bi.val(bE(bZ.serving_size));if(bZ.nutrition){bY=bZ.nutrition;m.val(bE(bY.calories));aB.val(bE(bY.totalFat));bA.val(bE(bY.saturatedFat));aG.val(bE(bY.unsaturatedFat));a5.val(bE(bY.transFat));am.val(bE(bY.totalCarbohydrates));bF.val(bE(bY.sugars));e.val(bE(bY.sodium));B.val(bE(bY.dietaryFiber));aX.val(bE(bY.protein));c.val(bE(bY.cholesterol))}else{m.val(bE(bZ.calories));aB.val(bE(bZ.fat))}for(b0=0;b0<b1.ingredients.length;b0++){bW+=G(bE(b1.ingredients[b0]))+"\n"}bu.val(bW);k.val(bE(bZ.instructions.replace("\r","")));u.val(bE(bZ.notes));ba.dialog("option","title","Update Recipe");t.dialog(l);bN.hide();bz.show();ap.hide();if(D!==""){aa(D,bO.length,true)}bT=bK();ba.dialog(aW,aA,ab);ba.dialog(H)}function aZ(){var bW;y.show();bD.unbind(ao);bt.unbind(ao);bW={action:"easyrecipeConvert",id:a9,type:a3};bI.post(ajaxurl,bW,J,"json")}function z(b6){var b5,cf,b7,b1=0,cb,b0="",bW="",bX="",b3="";var b4=["instruction","method","cooking method","procedure"];var cg=["ingredients?"];var bY=["note","cooking note"];var ch;var cc;var bZ;var cd,b8,ca;var ce,b2,b9;ce=bI.parseJSON(v.ingredients);b2=bI.parseJSON(v.instructions);b9=bI.parseJSON(v.notes);if(bI.inArray(ce,cg)===-1){cg.push(ce)}cc="^\\s*(?:"+cg.join("|")+")";b8=new RegExp(cc,"i");if(bI.inArray(b2,b4)===-1){cg.push(b2)}ch="^\\s*(?:"+b4.join("|")+")";cd=new RegExp(ch,"i");if(bI.inArray(b9,bY)===-1){bY.push(b9)}bZ="^\\s*(?:"+bY.join("|")+")\\s*$";ca=new RegExp(bZ,"i");cb=bI("<div>"+b6+"</div>");b5=p(cb[0].childNodes);b5=b5.split("\n");for(cf=0;cf<b5.length;cf++){b7=bI.trim(b5[cf]);if(b7===""){continue}if(cd.test(b7)){b1=2;continue}if(b8.test(b7)){b1=1;continue}if(ca.test(b7)){b1=3;continue}switch(b1){case 0:b0+=b7+"\n";break;case 1:bW+=b7+"\n";break;case 2:bX+=b7+"\n";break;case 3:b3+=b7+"\n";break}}return{summary:b0,ingredients:bW,instructions:bX,notes:b3}}function at(){L.dialog(aW,aA,ab);L.dialog(H)}function Z(bZ,bW,bX){var bY;var b0=function(){var b1,b5,b4,b2,b3=bI.data(this,"index");b1=this.width/150;b5=this.height/112;b1=b1>b5?b1:b5;b4=Math.floor(this.height/b1);b2=Math.floor(this.width/b1);bO[b3].height(b4);bO[b3].width(b2);bO[b3].css("top",(112-b4)/2);bO[b3].attr("src",this.src);if(b3===0){bI("#ERDTabs").find(".divERNoPhotos").remove()}};aE.append('<div class="ERPhoto"><img style="position:relative" id="ERPhoto_'+bW+'" /></div>');bO[bW]=bI("#ERPhoto_"+bW,aE);bO[bW].data("src",bZ);if(bX){bI(".ERPhoto",aE).removeClass(aR);bO[bW].parent().addClass(aR);bG=bW;D=bZ}if(bk===""){bk=bZ}bY=new Image();bI.data(bY,"index",bW);bY.onload=b0;bY.src=bZ}function ad(){Z(ax.val(),bO.length,true);ax.val("");C.hide();bI(".divERNoPhotos").remove()}function ac(cd,cg){var b0;var ci;var b5,b2;var ce;var b1;var ch,bW,cc,cb,b7,b4,b8,b9,cj;var bZ={},b3="",bY="",bX="",ca="",cf;var b6;if(cg===aC&&aY!==0){at();return}if(cd&&cd.data===ay){cg=ay;cd=cd.delegateTarget}if(typeof cg===aM&&typeof cd===aM){a0=0}aY=1;a0=0;bT=bI(".easyrecipe:first",aH);if(cg!==aC&&bT.length>1){bT=bI(bT[cg]);a0=cg}ci=0;b8=bI.support.cors?"json":"jsonp";bI.ajax(ae,{dataType:b8,data:{v:v.version,p:ci,u:v.wpurl},success:Y,error:X});R=false;if(typeof tinyMCE!==aM){if(tinyMCE.activeEditor&&!tinyMCE.activeEditor.isHidden()){R=true}}if(!R){alert("You must use the Visual Editor to add or update an EasyRecipe");return}bx.val("");bb.val("");br.val("");aS.val("");w.val("");bP.val("");av.val("");aV.val("");bl.val("");bu.val("");k.val("");bi.val("");m.val("");aB.val("");bA.val("");aG.val("");a5.val("");am.val("");bF.val("");e.val("");B.val("");aX.val("");c.val("");u.val("");if(cg!==aC&&bT.length===1){ba.dialog("option","title","Update Recipe");ap.hide();bN.hide();bz.show();N=true}else{bB=Q.getContent();if(!M){b7=bS.exec(bB)||aD.exec(bB)||aL.exec(bB);if(!b7){b0=bI("#hasRecipe").is(":checked")}if(b7||b0){if(b0){a3="recipress";a9=v.postID}else{a3=b7[2];a9=b7[3]}y.hide();bD.click(bV);bt.click(aZ);b1=bU[a3];cb=bI("#txtERCNVText1",t);cb.html(cb.html().replace("#plugin#",b1));aE.html("");bG=-1;bO=[];aE.html(au);t.dialog(aW,aA,ab);t.dialog(H);return}}if(v.isGuest){b6=bI("#inpERAuthor").val()||"";w.val(b6)}bN.show();bz.hide();ap.show();ba.dialog("option","title","Add a New Recipe");N=false;if(U!==false){bZ=z(U)}else{cf=Q.selection.getContent();if(cf.length>20){bZ=z(cf)}}if(bZ.summary){b3=bZ.summary}if(bZ.ingredients){bY=bZ.ingredients}if(bZ.instructions){bX=bZ.instructions}if(bZ.notes){ca=bZ.notes}bT=bK()}bI("#inpERCuisine").autocomplete({source:bI.parseJSON(v.cuisines)}).autocomplete("widget").wrap('<div class="easyrecipeUI" />');bI("#inpERType").autocomplete({source:bI.parseJSON(v.recipeTypes)}).autocomplete("widget").wrap('<div class="easyrecipeUI" />');P=false;if(bI(".hrecipe",aH).length>0){if(confirm("This post is already hrecipe microformatted\n\nDo you want me to try to convert it to an EasyRecipe?")){P=true}}bg=(cg!==aC)?bT.find(".endeasyrecipe").text():v.version;if(bg===""){bg="2.2"}D=bI('link[itemprop="image"]',bT).attr("href")||"";aE.html("");bG=-1;bk="";bO=[];aH.find("img").each(function(ck){var cl=false;if(bg<"3"){if(bI(this).hasClass("photo")){cl=true}}else{cl=this.src===D}Z(this.src,ck,cl)});ce=aH.contents().text();b7=aj.exec(ce);b9=bO.length;while(b7!==null){b2=bh.exec(b7[0]);if(b2!==null){b5=b2[1];Z(b5,b9);if(bg>"3"){if(D===b5){bO[b9].parent().addClass(aR);bG=b9}}else{if(O.test(b7[0])){bO[b9].parent().addClass(aR);bG=b9;D=b5}}b9++}b7=aj.exec(ce)}if(D!==""){bW=false;for(ch=0;ch<bO.length;ch++){if(bO[ch].data("src")===D){bW=true;break}}if(!bW){Z(D,bO.length,true)}}if(bG===-1&&bO.length>0){bG=0;D=bk;bO[0].parent().addClass(aR)}aE.click(function(){L.dialog(aW,aA,ab);L.dialog(H)});if(bO.length===0){aE.html(au)}else{if(bG===-1){bO[0].parent().addClass(aR)}}bo=[];bj=[];cj=bT.find(".ERName .fn").html()||bT.find(".ERName").html();if(!cj||cj===""){bx.val(af(bE(bI("#title").val())))}else{bx.val(af((bE(cj))))}bb.val(af(bE(bT.find(".type").html())));w.val(af(bE(bT.find(".author").html())));if(w.val()===""){w.val(af(bI.parseJSON(v.author)))}br.val(af(bE(bT.find(".cuisine").html())));bP.val(af(b3+bE(bT.find(".summary").html())));if(bg>"3"){b4=bT.find('time[itemprop="prepTime"]').html()||"";av.val(bE(b4));b4=bT.find('time[itemprop="cookTime"]').html()||"";aV.val(bE(b4))}else{b4=bT.find(".preptime").html()||"";b7=bd.exec(b4);if(b7!==null){av.val(bE(b7[1]))}else{av.val("")}b4=bT.find(".cooktime").html()||"";b7=bd.exec(b4);if(b7!==null){aV.val(bE(b7[1]))}else{aV.val("")}}bl.val(bE(bT.find(".yield").html()));bT.find(".ingredients li").each(function(cl,ck){if(bI(ck).hasClass(aJ)){bY+="!"+af(bE(ck.innerHTML))+"\n"}else{bY+=af(bE(ck.innerHTML))+"\n"}});bu.val(bY);bT.find(".instructions li, .instructions .ERSeparator").each(function(cl,ck){cc=bI.trim(ck.innerHTML.replace(/^[ 0-9.]*(.*)$/ig,"$1"));if(bI(ck).hasClass(aJ)){bX+="!"+cc+"\n"}else{bX+=cc+"\n"}});k.val(af(bE(bX)));bi.val(bE(bT.find(".servingSize").html()));m.val(bE(bT.find(".calories").html()));aB.val(bE(bT.find(".fat").html()));bA.val(bE(bT.find(".saturatedFat").html()));aG.val(bE(bT.find(".unsaturatedFat").html()));a5.val(bE(bT.find(".transFat").html()));am.val(bE(bT.find(".carbohydrates").html()));bF.val(bE(bT.find(".sugar").html()));e.val(bE(bT.find(".sodium").html()));B.val(bE(bT.find(".fiber").html()));aX.val(bE(bT.find(".protein").html()));c.val(bE(bT.find(".cholesterol").html()));cc=(bE(bT.find(".ERNotes").html())||"").replace(/<\/p>\n*<p>/ig,"\n\n").replace(/(?:<p>|<\/p>)/ig,"").replace(/<br *\/?>/ig,"\n");if(cc===""&&ca!==""){cc=ca}u.val(af(cc));if(F){if(F.name){bx.val(af((bE(F.name))))}if(F.author){w.val(af(F.author))}if(F.summary){bP.val(af(F.summary))}if(F.yield){bl.val(bE(F.yield))}if(F.type){bb.val(af(bE(F.type)))}if(F.cuisine){br.val(af(bE(F.cuisine)))}if(F.prepTime){av.val(bE(F.prepTime))}if(F.cookTime){aV.val(bE(F.cookTime))}if(F.summary){bP.val(af(F.summary))}}ba.dialog(aW,aA,ab);ba.dialog(H);ba.dialog("option","position","center")}function A(bW){aY=bI(".easyrecipe",aH).length;if(I||aY===0){ac(bW,aC);return}L.dialog(aW,aA,ab);L.dialog(H)}function a4(){ba.dialog(l)}function q(){var bW=confirm("Are you sure you want to delete this recipe?");if(bW){bT.remove();bT=false}ba.dialog(l)}function ai(){var bX=bI("#inpERPaste");var bW,bY=bX.val();bW=z(bY);if(bW.ingredients.length===0&&bW.instructions.length===0){return}U=bY;bX.val("");F={name:g(x(bx.val())),author:g((aw(w))),yield:aw(bl),type:g((aw(bb))),cuisine:g((aw(br))),summary:g(aw(bP)),servesize:aw(bi),prepTime:av.val(),cookTime:aV.val()};ba.dialog(l);A(null)}function bH(bX){var bW=bI(bX.target).parent();var bY=bW.parent();if(bW.hasClass("easyrecipeAbove")){bY.before(ah)}else{bY.after(ah)}bI(".easyrecipeAbove,.easyrecipeBelow",bY).remove();a8(bI(".easyrecipe",bY).unwrap())}function bL(b0){var bX,bW,bZ,bY;bZ=b0.prev();bY=b0.next();bX=(bZ.length===0||bZ.hasClass("easyrecipe")||bZ.hasClass("easyrecipeWrapper"));if(bX){bX=!(b0[0].previousSibling&&b0[0].previousSibling.nodeType===3)}bW=(bY.length===0||bY.hasClass("easyrecipe")||bY.hasClass("easyrecipeWrapper"));if(bW){bW=!(b0[0].nextSibling&&b0[0].nextSibling.nodeType===3)}if(!bX&&!bW){return}b0.wrap('<div class="easyrecipeWrapper" />');if(bX){b0.parent().prepend('<div class="easyrecipeAbove"><input class="ERInsertLine" type="button" value="Insert line above" /></div>')}if(bW){b0.parent().append('<div class="easyrecipeBelow"><input class="ERInsertLine" type="button" value="Insert line below" /></div>')}bI(".easyrecipeWrapper .ERInsertLine",aH).on(ao,bH)}function h(bW){bI(".easyrecipeAbove,.easyrecipeBelow",bW).remove();bI(".easyrecipe",bW).unwrap()}function bs(){var bW=bI(".easyrecipe",aH);if(bW.length===0){return}bW.on("mousedown",null,ay,ac);h(bI(".easyrecipeWrapper",aH));bW.each(function(){bL(bI(this))})}function aT(){var b8,b2="",bZ,b7="",bW=0,cc="";var ce,ca,b6,b0,cd,b3,b9,bX=[],b1;var bY,cb,b5,b4;if(!S(av)){return}if(!S(aV)){return}bZ=bI.trim(av.val());if(bZ!==""){bM=s.exec(bZ);ce=bM[1]?parseInt(bM[1],10):0;ca=bM[2]?parseInt(bM[2],10):0;bW=ce*60+ca;b6=ce>0?ce+"H":"";b0=ca>0?ca+"M":"";b7="PT"+b6+b0}else{bZ=false}b8=bI.trim(aV.val());if(b8!==""){bM=s.exec(b8);ce=bM[1]?parseInt(bM[1],10):0;ca=bM[2]?parseInt(bM[2],10):0;b6=ce>0?ce+"H":"";b0=ca>0?ca+"M":"";bW+=ce*60+ca;b2="PT"+b6+b0}else{b8=false}if(bW>0){ce=Math.floor(bW/60);ca=bW%60;b6=ce>0?ce+" hour":"";if(ce>1){b6+="s"}b0=ca>0?ca+" min":"";if(ca>1){b0+="s"}bW=bI.trim(b6+" "+b0);b6=ce>0?ce+"H":"";b0=ca>0?ca+"M":"";cc="PT"+b6+b0}else{bW=false}cd=bu.val().split("\n");for(b9=0;b9<cd.length;b9++){b3=cd[b9];if(b3!==""){if(b3.charAt(0)==="!"){b1=true;b3=b3.substr(1)}else{b1=false}bX.push({ingredient:g(x(b3)),hasHeading:b1})}}cd=k.val().split("\n");cb=[];bY={INSTRUCTIONS:[]};for(b9=0;b9<cd.length;b9++){b3=bI.trim(cd[b9].replace(/^[ 0-9\.]*(.*)$/ig,"$1"));if(b3!==""){if(b3.charAt(0)==="!"){if(bY.INSTRUCTIONS.length>0||bY.heading){cb.push(bY)}b3=b3.substr(1);bY={};bY.INSTRUCTIONS=[];bY.heading=x(b3)}else{bY.INSTRUCTIONS.push({instruction:g(x(b3))})}}}if(bY.INSTRUCTIONS.length>0||bY.heading){cb.push(bY)}b3=aw(u);if(b3&&v.wpVersion<"3.5"){b3="<p>"+b3.replace(/\n\n/ig,"</p><p>").replace(/\n/ig,"<br />")+"</p>"}b5={version:v.version,hasPhoto:D!=="",photoURL:D,name:g(x(bx.val())),author:g((aw(w))),preptime:bZ,cooktime:b8,totaltime:bW,preptimeISO:b7,cooktimeISO:b2,totaltimeISO:cc,yield:aw(bl),type:g((aw(bb))),cuisine:g((aw(br))),summary:g(aw(bP)),servesize:aw(bi),calories:aw(m),fat:aw(aB),satfat:aw(bA),unsatfat:aw(aG),transfat:aw(a5),carbs:aw(am),sugar:aw(bF),sodium:aw(e),fiber:aw(B),protein:aw(aX),cholesterol:aw(c),notes:g(b3),INGREDIENTS:bX,STEPS:cb};if(b5.name===""){b5.name=false}b4=aU(v.recipeTemplate,b5);if(P){bI(".hrecipe",aH).remove()}if(a0===-1){bT=bI(i,aH)}else{bT=bI(".easyrecipe",aH);if(bT.length>0){bT=bI(bT[a0])}}bT.before(b4);bT.remove();bT=false;bC.show();ba.dialog(l);aY=bI(".easyrecipe",aH).length;bs()}function bq(bZ,bW,b0){var bX;var bY;F=false;if(bW.editorId!==aq&&bW.editorId!=="wp_mce_fullscreen"){bI("#"+bW.editorId+"_easyrecipeTest").hide();bI("#"+bW.editorId+"_easyrecipeEdit").hide();bI("#"+bW.editorId+"_easyrecipeAdd").hide();return}if(bW.editorId===aq){aH=bI("#"+aq+"_ifr").contents();ab=10000;bX=bI("#"+aq+"_easyrecipeTest");bC=bI("#"+aq+"_easyrecipeEdit")}else{aH=bI("#wp_mce_fullscreen_ifr").contents();ab=200001;bX=bI("#mce_fullscreen_easyrecipeTest");bC=bI("#mce_fullscreen_easyrecipeEdit")}bn=bI("body",aH);bY=bI(".easyrecipe",aH);Q=tinyMCE.activeEditor;bY.each(function(){bI(this).addClass("mceNonEditable");bI(".ERRatingOuter",this).remove();bI(".ERHDPrint",this).remove();bI(".ERLinkback",this).remove()});aY=bY.length;if(aY>0&&v.testURL!==""){bX.show()}else{bX.hide()}if(aY>0){bC.show()}else{bC.hide()}if(!aH.hasERCSS){bI("head",aH).append('<link rel="stylesheet" type="text/css" href="'+v.easyrecipeURL+'/css/easyrecipe-entry.css" />');aH.hasERCSS=true}bs()}function aQ(){bc.toggleClass("ERNone");bf.toggleClass("ERContract")}function a6(){bp.toggleClass("ERNone");by.toggleClass("ERContract")}function aN(){if(window.getSelection){return window.getSelection()}if(document.getSelection){return document.getSelection()}if(document.selection){return document.selection.createRange().text}return null}function T(b0,bY){var b1,bX,bZ,bW=/(?:<a( .*?")>)?<img( (?:.*?)?src="([^"]*?)"(?:.*)) \/>/i;bX=bW.exec(bY);b1=bI("#ertmp_"+r,aH);if(bX!==null){Z(bX[3],bO.length);bZ=aP.substring(0,be);if(!bX[1]){bo.push(bX[2]);bZ+="[img:"+bo.length+"]"}else{bj.push(bX[1]);bo.push(bX[2]);bZ+="[url:"+bj.length+"][img:"+bo.length+"][/url]"}bZ+=aP.substring(aI);n.val(bZ)}n[0].focus();b1.remove()}function j(bZ){var bW,bX,bY,b2,b1,b0;if(!v.isEntryDialog){return}bW=bI("#ertmp_"+r,aH);if(typeof bZ==="string"){bY=bI(bZ)}else{b0=bW.html();if(b0==="link"){bY=bW.parent("a");bW=bY}else{bY=bI(bW.html())}}if(bY.is("a")){bX=bY.attr("href");b2=bY.attr("title");b1=bY.attr("target");b2=b2?' title="'+b2+'"':"";b1=b1?' target="'+b1+'"':"";bZ='href="'+bX+'"'+b1+b2;bj.push(bZ);n.val(aP.substring(0,be)+"[url:"+bj.length+"]"+aP.substring(be,aI)+"[/url]"+aP.substring(aI))}n[0].focus();bW.remove()}function al(){var bY,bZ,bX=false,bW;at()}function an(){F=false;A()}function aO(){F=false;ac()}function a1(){if(aY>0&&!bQ){bQ=true;bm.dialog(aW,aA,ab);bm.dialog(H)}}function aF(b1){var bY,bZ,b0,bX;var bW=bI("#wp-preview",b1.target).val();if(bW==="dopreview"){return true}if(aY===0){return true}b0=tinyMCE.activeEditor&&!tinyMCE.activeEditor.isHidden();if(b0){bZ=bI("<div>"+Q.getContent()+"</div>")}else{bX=bI("#wp-content-editor-container").find("textarea");bZ=bI("<div>"+bX.val()+"</div>")}h(bI(".easyrecipeWrapper",bZ));bI(".easyrecipe",bZ).removeClass("mceNonEditable");bY=bI.trim(bZ.html());if(b0){Q.setContent(bY)}else{bX.val(bY)}return true}bI(function(){var bZ;var bX;var bY;var bW=null;v=EASYRECIPE;if(v.button!==bI.fn.button){bW=bI.fn.button;bI.fn.button=v.button}ba=bI("#easyrecipeEntry");L=bI("#easyrecipeUpgrade");bm=bI("#easyrecipeHTMLWarn");aq=v.isGuest?"guestpost":"content";ba.dialog({autoOpen:false,width:655,modal:true,dialogClass:"easyrecipeEntry",close:function(){v.isEntryDialog=false;if(bT&&!N){bT.remove()}bT=false;bI(".easyrecipeEntry").filter(function(){return bI(this).text()===""}).remove()},open:function(){v.isEntryDialog=true;bI(".ui-widget-overlay").wrap('<div class="easyrecipeUI" />');d.tabs({selected:0,select:ak});setTimeout(function(){var b0=bI(".easyrecipeEntry");var b1=b0.offset();if(b1.top<W){b1.top=W;b0.offset(b1)}},250)}});ba.parent(".ui-dialog").wrap('<div class="easyrecipeUI" />');bI("#divERContainer").show();bm.dialog({autoOpen:false,width:420,modal:true,dialogClass:"easyrecipeHTMLWarn",close:function(){bI(".easyrecipeHTMLWarn").filter(function(){return bI(this).text()===""}).remove()},open:function(){bI(".ui-widget-overlay").wrap('<div class="easyrecipeUI" />')}});bm.parent(".ui-dialog").wrap('<div class="easyrecipeUI" />');bI(".divERHTMLWarnContainer").show();L.dialog({autoOpen:false,width:420,modal:true,dialogClass:"easyrecipeUpgrade",close:function(){bI(".easyrecipeUpgrade").filter(function(){return bI(this).text()===""}).remove()},open:function(){bI(".ui-widget-overlay").wrap('<div class="easyrecipeUI" />')}});L.parent(".ui-dialog").wrap('<div class="easyrecipeUI" />');bI(".divERUPGContainer").show();t=bI("#easyrecipeConvert");y=bI("#divERCNVSpinner");bD=bI("#btnERCNVCancel");bt=bI("#btnERCNVOK");y.hide();t.dialog({autoOpen:false,width:390,modal:true,dialogClass:"easyrecipeConvert",close:function(){bI(".easyrecipeConvert").filter(function(){return bI(this).text()===""}).remove()},open:function(){bI(".ui-widget-overlay").wrap('<div class="easyrecipeUI" />')}});bI("#divERCNVContainer").show();t.parent(".ui-dialog").wrap('<div class="easyrecipeUI" />');bI(window).bind("easyrecipeadd",an);bI(window).bind("easyrecipeedit",aO);bI(window).bind("easyrecipeload",bq);bI(window).bind("easyrecipeimage",T);bI(window).bind("easyrecipeguestimageuploaded",T);a7=bI("#divERNext");V=bI("#btnERButtons");d=bI("#ERDTabs");aE=bI("#divERPhotos");bI("input:submit",".easyrecipeUI").button();f=bI("#ed_toolbar");bx=bI("#inpERName");w=bI("#inpERAuthor");bb=bI("#inpERType");br=bI("#inpERCuisine");aS=bI("#inpERTags");bP=bI("textarea#taERSummary");bu=bI("textarea#taERIngredients");k=bI("textarea#taERInstructions");av=bI("#inpERPrepTime");aV=bI("#inpERCookTime");bl=bI("#inpERYield");bi=bI("#inpERServeSize");m=bI("#inpERCalories");aB=bI("#inpERFat");bA=bI("#inpERSatFat");aG=bI("#inpERUnsatFat");a5=bI("#inpERTransFat");am=bI("#inpERCarbs");bF=bI("#inpERSugar");e=bI("#inpERSodium");B=bI("#inpERFiber");aX=bI("#inpERProtein");c=bI("#inpERCholesterol");u=bI("textarea#taERNotes");C=bI("#divERAddImageURL");bY=bI("#lnkERPhotoURL");bw=bI(".ERTimeError");bN=bI("#divERAdd");bz=bI("#divERChange");K=bI("#divERHeader");bc=bI("#divEROther");bf=bI("#divEROtherLabel");bp=bI("#divERNotes");by=bI("#divERNotesLabel");ap=bI("#ERDPasteTab");ax=bI("#fldERAPUImageURL");bI("#btnERAdd").click(aT);bI("#btnERNext").click(a);bI("#btnERChange").click(aT);bI("#btnERDelete").click(q);bI("#btnERCancel").click(a4);bY.click(function(){L.dialog(aW,aA,ab);L.dialog(H)});bI("#btnERAIUCancel").click(function(){C.hide()});bI("#btnERAIUOK").click(ad);bf.click(aQ);by.click(a6);av.change(function(b0){S(bI(b0.target))});aV.change(function(b0){S(bI(b0.target))});bI("#btnERPaste").click(ai);W=bI("#wpadminbar").height();a2=bI("#divEREditBtns").on("mousedown","li",al);bI('#divERContainer input[type="text"], #divERContainer textarea').on("blur",function(){ag=null}).on("focus",function(){ag=bI(this)});bI("#wp-link").bind("wpdialogclose",j);bv=A;bR=ac;U=false;v.insertLink=j;v.insertUploadedImage=T;a8=bL;aa=Z;v.addListener=bs;bm.find("input").on(ao,function(){bm.dialog(l)});bI("#wp-content-editor-tools").on(ao,"#content-html",a1);bI("#post").on("submit",aF);if(bW!==null){bI.fn.button=bW}})}(jQuery));