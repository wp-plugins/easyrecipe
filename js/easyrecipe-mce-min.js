/*! EasyRecipe 3.3.3070 Copyright (c) 2015 BoxHill LLC */
!function(e){var n,t,o="mceNonEditable",i=null,a=!1;tinymce.create("tinymce.plugins.EasyRecipe",{init:function(r,d){n=tinymce.VK||tinymce.util.VK,d=d.replace(/js$/g,"images/"),r.onSaveContent.add(function(e,n){}),r.onLoadContent.add(function(n,t){"mce_fullscreen"!==n.editorId&&e(window).trigger("easyrecipeload",[n,t])}),r.onSetContent.add(function(n,t){"mce_fullscreen"!==n.editorId||t.initial||e(window).trigger("easyrecipeload",[n,t])}),r.addButton("easyrecipeEdit",{title:"Edit an EasyRecipe",image:d+"chef20edit.png",onclick:function(){e(window).trigger("easyrecipeedit")}}),r.addButton("easyrecipeAdd",{title:"Add an EasyRecipe",image:d+"chef20add.png",onclick:function(){e(window).trigger("easyrecipeadd")}}),r.addButton("easyrecipeTest",{title:"Test Rich Snippet Formatting at Google",image:d+"google-dev.png",onclick:function(){""!==t.testURL&&window.open("https://developers.google.com/webmasters/structured-data/testing-tool?url="+encodeURIComponent(t.testURL))}}),r.onKeyDown.addToTop(function(r,d){var c,s,l,g,u,m;if(d.keyCode===n.BACKSPACE){if(m=r.dom.getParent(r.selection.getStart(),function(e){return r.dom.hasClass(e,o)}),u=r.dom.getParent(r.selection.getEnd(),function(e){return r.dom.hasClass(e,o)}),m||u)return tinymce.dom.Event.cancel(d)}else if(d.keyCode===n.DELETE){if(l=r.selection.getNode(),g=e(l),g.hasClass(o))return tinymce.dom.Event.cancel(d);if(i=e(l.nextSibling),!i.hasClass(o))return!0;if(s=r.selection.getRng(),c=s.endContainer.length||0,console.log("offset: "+s.endOffset+"  len: "+c),s.endOffset===c)return tinymce.dom.Event.cancel(d);if("P"===l.parentNode.nodeName&&1==l.parentNode.children.length&&!a&&e(l.parentNode.nextSibling).hasClass(o))return l.parentNode.parentNode.removeChild(l.parentNode),t.addListener(),tinymce.dom.Event.cancel(d)}return!0}),r.onKeyUp.addToTop(function(i,r){var d,c,s;r.keyCode===n.DELETE?(s=i.selection.getNode(),-1!==e(s).text().indexOf("_ERSTOP_")&&(i.undoManager.undo(),t.addListener()),d=e("#ERStop",i.getDoc()),d.remove(),a=!1):r.keyCode===n.BACKSPACE&&(d=i.dom.getParent(i.selection.getStart(),function(e){return i.dom.hasClass(e,o)}),c=i.dom.getParent(i.selection.getEnd(),function(e){return i.dom.hasClass(e,o)}),(d||c)&&(i.undoManager.undo(),t.addListener()))}),r.onBeforeExecCommand.add(function(n,o,i,a){var r,d,c,s;return"mceInsertLink"===o&&t.isEntryDialog&&"string"!==e.type(a)?(t.insertLink(a),!1):("mceInsertContent"===o&&(r=n.selection.getNode(),d=e(r),c=d.hasClass("easyrecipe")?d:d.parents(".easyrecipe"),c.length>0&&(s=e("<p>Stuff</p>").insertAfter(c),n.selection.select(s[0]))),!0)}),r.onPreProcess.add(function(n,t){t.get&&e(".value-title, .ERRatingInner",t.node).html("#ERDeleteMe#")}),r.onPostProcess.add(function(e,n){n.get&&(n.content=n.content.replace(/#ERDeleteMe#/gi," "))})},getInfo:function(){return{longname:"EasyRecipe",author:"The Orgasmic Chef",authorurl:"http://www.orgasmicchef.com",infourl:"http://www.easyrecipeplugin.com/",version:"1.2"}}}),t=EASYRECIPE,tinymce.PluginManager.add("easyrecipe",tinymce.plugins.EasyRecipe)}(jQuery);