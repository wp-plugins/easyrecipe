(function(){var ak=jQuery,Q=jQuery.trim;ak(window).bind("easyrecipeopen",M);ak(window).bind("easyrecipeload",i);var aD,am,S,u,x,ah,q,r,P;var aC,N,E,B=false,aj,y,aB,aw;var w=/<!-- START INCLUDEIF (!?)([_a-z][_0-9a-z]{0,19}) -->/i;var av=/^#([_a-z][_0-9a-z]{0,19})#/im;var n=/<!-- START REPEAT ([_a-zA-Z][_0-9a-zA-Z]{0,19}) -->/m;var aE=/^([^<]*)</,h=/^(?:([0-9]+) *(?:h|hr|hrs|hour|hours))? *(?:([0-9]+) *(?:m|mn|mns|min|mins|minute|minutes))?$/i,W=/^([0-9]+)$/;var m=/(.*)\[amd-recipeseo-recipe:([0-9]+)\](.*)/;var Z=/PT(?:([0-9]*)+H)?([0-9]+)+M/i;var ag='<span class="easyrecipeholder" />',aA=".easyrecipeholder",k="ERSeparator";var ap,F,aq,a,ai,ao="option",J="zIndex",s;var T,e,K,V,O,I,R,al,v,ab;var ax,G,D,at,d,X,Y,z,o,c,ad;var l;var H="close",p="click",au="open";ak(U);function U(){ap=ak("#easyrecipeDialog");ap.dialog({autoOpen:false,width:645,modal:true,dialogClass:"wp-dialog",close:function(){if(aB&&!aw){aB.remove()}aB=false}});ak("#divERContainer").show();F=ak("#easyrecipeConvert");T=ak("#divERCNVSpinner");e=ak("#btnERCNVCancel");K=ak("#btnERCNVOK");ak("#divERCNVContainer").show();T.hide();F.dialog({autoOpen:false,width:350,modal:true,dialogClass:"wp-dialog"});S=ak("#inpERName");aC=ak("#inpERAuthor");N=ak("#inpERType");u=ak("textarea#taERSummary");x=ak("textarea#taERIngredients");ah=ak("textarea#taERInstructions");q=ak("#inpERPrepTime");r=ak("#inpERCookTime");P=ak("#inpERYield");ax=ak("#inpERServeSize");G=ak("#inpERCalories");D=ak("#inpERFat");at=ak("#inpERSatFat");d=ak("#inpERUnsatFat");X=ak("#inpERCarbs");Y=ak("#inpERSugar");z=ak("#inpERFiber");o=ak("#inpERProtein");c=ak("#inpERCholestrol");ad=ak("textarea#taERNotes");E=ak(".ERTimeError");V=ak("#divERAdd");O=ak("#divERChange");I=ak("#divERHeader");R=ak("#divEROther");al=ak("#divEROtherLabel");v=ak("#divERNotes");ab=ak("#divERNotesLabel");ak("#easyrecipeLaunch").click(M);ak("#btnERAdd").click(A);ak("#btnERChange").click(A);ak("#btnERDelete").click(af);ak("#btnERCancel").click(ar);al.click(t);ab.click(az);ak("#inpERPrepTime").change(function(aF){an(ak(aF.target))});ak("#inpERCookTime").change(function(aF){an(ak(aF.target))})}function f(){e.unbind(p);K.unbind(p);F.dialog(H);B=true;M()}function L(aJ,aG){var aI,aF="",aH=aJ.recipe;if(aG!="success"){F.dialog(H);B=true;M()}S.val(ae(aH.recipe_title));N.val("");aC.val("");u.val(ae(aH.summary));ai=Z.exec(aH.prep_time);if(ai!=null){aI=ai[1]?ai[1]+"h ":"";q.val(aI+ai[2]+"m")}else{q.val(ae(aH.prep_time))}ai=Z.exec(aH.cook_time);if(ai!=null){aI=ai[1]?ai[1]+"h ":"";r.val(aI+ai[2]+"m")}else{r.val(ae(aH.cook_time))}P.val(ae(aH.yield));G.val(ae(aH.calories));D.val(ae(aH.fat));ax.val(ae(aH.serving_size));for(aI=0;aI<aJ.ingredients.length;aI++){aF+=Q(ae(aJ.ingredients[aI]))+"\n"}x.val(aF);ah.val(ae(aH.instructions.replace("\r","")));I.html("Update Recipe");F.dialog(H);V.hide();O.show();s=true;aB=C();ap.dialog(ao,J,a);ap.dialog(au)}function g(){T.show();e.unbind(p);K.unbind(p);var aF={action:"convertRecipeSEO",id:l};ak.post(ajaxurl,aF,L,"json")}function an(aJ){var aF=ak.trim(aJ.val()),aG=0,aI=0,aH,aK;E.hide();if(aF==""){return true}ai=h.exec(aF);if(ai==null){ai=W.exec(aF);if(ai==null){E.show();return false}aG=0;aI=ai[1]}else{aG=ai[1]?parseInt(ai[1]):0;aI=ai[2]?parseInt(ai[2]):0}if(aG==0&&aI==0){aJ.val("")}else{aH=aG>0?aG+" hour":"";if(aG>1){aH+="s"}aK=aI>0?aI+" min":"";if(aI>1){aK+="s"}aJ.val(ak.trim(aH+" "+aK))}return true}function j(aJ){var aG,aF,aH,aI="";for(aG=0;aG<aJ.length;aG++){aF=aJ[aG];if(aF.nodeType==3){aH=ak.trim(aF.nodeValue);if(aH!=""){aI+=aH+"\n"}continue}if(aF.nodeType!=1){continue}if(aF.childNodes.length>0){aI+=j(aF.childNodes)}}return aI}function C(){ak(aA,aq).remove();var aF=aD.selection.getNode();if(aF.tagName.toLowerCase()=="body"){ak(aF).append("&nbsp;"+ag)}else{while(aF.parentNode.tagName.toLowerCase()!="body"){aF=aF.parentNode}if(aF.tagName.toLowerCase()=="div"||aF.tagName.toLowerCase()=="span"){ak(aF,aq).after(ag)}else{ak(aF,aq).before(ag)}}return ak(aA,aq)}function M(){var aN,aI;var aJ="",aH="";am=false;if(typeof tinyMCE!="undefined"){if(tinyMCE.activeEditor&&!tinyMCE.activeEditor.isHidden()){am=true}}if(!am){alert("You must use the Visual Editor to add or update an Easy Recipe");return}aD=tinyMCE.activeEditor;S.val("");N.val("");aC.val("");u.val("");q.val("");r.val("");P.val("");x.val("");ah.val("");ax.val("");G.val("");D.val("");at.val("");d.val("");X.val("");Y.val("");z.val("");o.val("");c.val("");ad.val("");aB=ak(".easyrecipe",aq);if(aB.length>0){I.html("Update Recipe");V.hide();O.show();aw=true}else{y=aD.getContent();if(!B){aI=m.exec(y);if(aI){l=aI[2];T.hide();e.click(f);K.click(g);F.dialog(ao,J,a);F.dialog(au);return}}V.show();O.hide();I.html("Add a New Recipe");aw=false;var aL=aD.selection.getContent();if(aL.length>20){aL=ak("<div>"+aL+"</div>");var aM=j(aL[0].childNodes);aM=aM.split("\n");var aK=false;for(aL=0;aL<aM.length;aL++){if(/^(?:instruction|method|cooking method)/i.test(aM[aL])){aK=true;continue}if(/^Ingredient/i.test(aM[aL])){continue}if(!aK){aJ+=aM[aL]+"\n"}else{aH+=aM[aL]+"\n"}}}aB=C()}aj=false;if(ak(".hrecipe",aq).length>0){if(aw){}else{if(confirm("This post is already hrecipe microformatted\n\nDo you want me to try to convert it to an EasyRecipe?")){aj=true}}}var aF=aq.find(".fn").html();if(typeof aF=="undefined"||!aF){S.val(ae(ak("#title").val()))}else{S.val(ae(aF))}N.val(ae(aq.find(".tag").html()));aC.val(ae(aq.find(".author").html()));u.val(ae(aq.find(".summary").html()));var aG=aq.find(".preptime").html();aI=aE.exec(aq.find(".preptime").html());if(aI!=null){q.val(ae(aI[1]))}else{q.val("")}aI=aE.exec(aq.find(".cooktime").html());if(aI!=null){r.val(ae(aI[1]))}else{r.val("")}P.val(ae(aq.find(".yield").html()));aq.find(".ingredients li").each(function(aP,aO){if(ak(aO).hasClass(k)){aJ+="!"+ae(aO.innerHTML)+"\n"}else{aJ+=ae(aO.innerHTML)+"\n"}});x.val(aJ);aq.find(".instructions li, .instructions .ERSeparator").each(function(aP,aO){aN=ak.trim(aO.innerHTML.replace(/^[ 0-9.]*(.*)$/ig,"$1"));if(ak(aO).hasClass(k)){aH+="!"+aN+"\n"}else{aH+=aN+"\n"}});ah.val(ae(aH));ax.val(ae(aq.find(".servingSize").html()));G.val(ae(aq.find(".calories").html()));D.val(ae(aq.find(".fat").html()));at.val(ae(aq.find(".saturatedFat").html()));d.val(ae(aq.find(".unsaturatedFat").html()));X.val(ae(aq.find(".carbohydrates").html()));Y.val(ae(aq.find(".sugar").html()));z.val(ae(aq.find(".fiber").html()));o.val(ae(aq.find(".protein").html()));c.val(ae(aq.find(".cholestrol").html()));aN=(ak(".ERNotes",aq).html()||"").replace(/<\/p>\n*<p>/ig,"\n\n").replace(/(?:<p>|<\/p>)/ig,"").replace(/<br *\/?>/ig,"\n");ad.val(aN);ap.dialog(ao,J,a);ap.dialog(au)}function ar(){ap.dialog(H)}function af(){var aF=confirm("Are you sure you want to delete this recipe?");if(aF){aB.remove();aB=false}ap.dialog(H)}function A(){var aS,aM="",aK,aR="",aG=0,aI="";var aX,aU,aQ,aL,aW,aN,aT,aH=[],aF;if(!an(q)){return}if(!an(r)){return}aK=ak.trim(q.val());if(aK!=""){ai=h.exec(aK);aX=ai[1]?parseInt(ai[1]):0;aU=ai[2]?parseInt(ai[2]):0;aG=aX*60+aU;aQ=aX>0?aX+"H":"";aL=aU>0?aU+"M":"";aR="PT"+aQ+aL}else{aK=false}aS=ak.trim(r.val());if(aS!=""){ai=h.exec(aS);aX=ai[1]?parseInt(ai[1]):0;aU=ai[2]?parseInt(ai[2]):0;aQ=aX>0?aX+"H":"";aL=aU>0?aU+"M":"";aG+=aX*60+aU;aM="PT"+aQ+aL}else{aS=false}if(aG>0){aX=Math.floor(aG/60);aU=aG%60;aQ=aX>0?aX+" hour":"";if(aX>1){aQ+="s"}aL=aU>0?aU+" min":"";if(aU>1){aL+="s"}aG=ak.trim(aQ+" "+aL);aQ=aX>0?aX+"H":"";aL=aU>0?aU+"M":"";aI="PT"+aQ+aL}else{aG=false}aW=x.val().split("\n");for(aT=0;aT<aW.length;aT++){aN=ak.trim(aW[aT].replace(/^[^0-9a-z!]*(.*)$/ig,"$1"));if(aN!=""){if(aN.charAt(0)=="!"){aF=true;aN=aN.substr(1)}else{aF=false}aH.push({ingredient:ac(aN),isSeparator:aF})}}aW=ah.val().split("\n");var aV=[];var aJ={INSTRUCTIONS:[]};for(aT=0;aT<aW.length;aT++){aN=ak.trim(aW[aT].replace(/^[ 0-9.]*(.*)$/ig,"$1"));if(aN!=""){if(aN.charAt(0)=="!"){if(aJ.INSTRUCTIONS.length>0||aJ.separator){aV.push(aJ)}aN=aN.substr(1);aJ=new Object();aJ.INSTRUCTIONS=[];aJ.separator=ac(aN)}else{aJ.INSTRUCTIONS.push({instruction:ac(aN)})}}}if(aJ.INSTRUCTIONS.length>0||aJ.separator){aV.push(aJ)}aN=aa(ad);if(aN){aN="<p>"+aN.replace(/\n\n/ig,"</p><p>").replace(/\n/ig,"<br />")+"</p>"}var aP={version:"1.0",name:ac(S.val()),author:aa(aC),preptime:aK,cooktime:aS,duration:aG,preptimeISO:aR,cooktimeISO:aM,durationISO:aI,yield:aa(P),type:aa(N),summary:aa(u),servesize:aa(ax),calories:aa(G),fat:aa(D),satfat:aa(at),unsatfat:aa(d),carbs:aa(X),sugar:aa(Y),fiber:aa(z),protein:aa(o),cholestrol:aa(c),notes:aN,INGREDIENTS:aH,STEPS:aV};var aO=ay(EASYRECIPE.recipeTemplate,aP);if(aj){ak(".hrecipe",aq).remove()}aB.before(aO);aB.remove();aB=false;ap.dialog(H);b()}function aa(aF){return ak.trim(ac(aF.val()))||false}function b(){var aF=ak(".easyrecipe",aq);aF.mousedown(function(aG){aG.stopPropagation();M()})}function i(aI,aG,aJ){var aH;if(aG.editorId=="content"){aq=ak("#content_ifr").contents();a=1000;aH=ak("#content_easyrecipeTest")}else{aq=ak("#mce_fullscreen_ifr").contents();a=200001;aH=ak("#mce_fullscreen_easyrecipeTest")}var aF=ak(".easyrecipe",aq);if(ak(".easyrecipe",aq).length>0&&EASYRECIPE.testURL!=""){aH.show()}else{aH.hide()}if(!aq.hasERCSS){ak("head",aq).append('<link rel="stylesheet" type="text/css" href="'+EASYRECIPE.pluginsURL+'/easyrecipe/easyrecipe-admin.css" />');aq.hasERCSS=true}b()}function t(){R.toggleClass("ERNone");al.toggleClass("ERContract")}function az(){v.toggleClass("ERNone");ab.toggleClass("ERContract")}function ae(aF){return aF?aF.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):""}function ac(aF){return aF?ak("<div />").text(aF).html():""}function ay(a9,aV){var a1=0,aW=1,aF=2,bb;var a2,aT,aM,aS="",aR="",a4,aG,aJ,a3,a6;var a5="<!-- START REPEAT ",bd="<!-- START INCLUDEIF ",bc="<!-- END INCLUDEIF ";var aI,aH,aO,a8,aZ,aN,aU,a0,ba,aQ;var aK,aY,a7;var aP,aX,aL;bb=a9;aV=aV||{};while(true){a4=bb.length;aG=bb.indexOf("#",aS);if(aG!==-1){a4=aG;aJ=a1}a3=bb.indexOf(a5,aS);if(a3!==-1&&a3<a4){a4=a3;aJ=aW}a6=bb.indexOf(bd,aS);if(a6!==-1&&a6<a4){a4=a6;aJ=aF}if(a4==bb.length){return aR+bb.substr(aS)}aI=a4-aS;aR+=bb.substr(aS,aI);aS=a4;switch(aJ){case aF:aT=bb.substr(aS,44);aM=w.exec(aT);if(aM!=null){aH=aM[1];aO=aH!="!";a8=aM[2]}else{break}aZ=bc+aH+a8+" -->";aN=aZ.length;aU=bb.indexOf(aZ);if(aU==-1){aS++;break}a0=typeof aV[a8]!=="undefined"&&aV[a8]!==false;if(a0===aO){ba="<!-- START INCLUDEIF "+aH+a8+" -->";aQ=ba.length;bb=bb.substr(0,aS)+bb.substr(aS+aQ,aU-aS-aQ)+bb.substr(aU+aN)}else{bb=bb.substr(0,aS)+bb.substr(aU+aN)}break;case a1:aT=bb.substr(aS,22);aM=av.exec(aT);if(aM===null){aR+="#";aS++;continue}aK=aM[1];if(aV[aK]!=""&&!aV[aK]){aR+="#"+aK+"#";aS+=aK.length+2;continue}aR+=aV[aK];aS+=aK.length+2;break;case aW:aT=bb.substr(aS,45);aM=n.exec(aT);if(aM===null){aR+="<";aS++;continue}aY=aM[1];if(!aV[aY]||!(aV[aY] instanceof Array)){aR+="<";aS++;continue}aS+=aY.length+22;a7=bb.indexOf("<!-- END REPEAT "+aY+" -->",aS);if(a7===-1){aR+="<!-- START REPEAT "+aY+" -->";continue}aP=a7-aS;aX=bb.substr(aS,aP);aL=aV[aY];for(a2=0;a2<aL.length;a2++){aR+=ay(aX,aL[a2])}aS+=aY.length+aP+20;break}}}})();