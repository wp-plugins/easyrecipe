(function(){var al=jQuery,Q=jQuery.trim;al(window).bind("easyrecipeopen",L);al(window).bind("easyrecipeload",i);var aF,an,S,u,x,ah,q,r,P;var aE,N,E,B=false,aj,y,aD,ax,ak;var w=/<!-- START INCLUDEIF (!?)([_a-z][_0-9a-z]{0,19}) -->/i;var aw=/^#([_a-z][_0-9a-z]{0,19})#/im;var n=/<!-- START REPEAT ([_a-zA-Z][_0-9a-zA-Z]{0,19}) -->/m;var aG=/^([^<]*)</,h=/^(?:([0-9]+) *(?:h|hr|hrs|hour|hours))? *(?:([0-9]+) *(?:m|mn|mns|min|mins|minute|minutes))?$/i,W=/^([0-9]+)$/;var m=/(.*)\[amd-recipeseo-recipe:([0-9]+)\](.*)/;var Z=/PT(?:([0-9]*)+H)?([0-9]+)+M/i;var aH='<input type="button" class="ed_button" value="Easy Recipe" />',aB="Use the Visual Editor to add or edit an Easy Recipe";var ag='<div class="easyrecipeholder">Easy recipe</div>',aC=".easyrecipeholder",k="ERSeparator";var aq,F,ar,a,ai,ap="option",J="zIndex",s;var T,e,K,V,O,I,R,am,v,ab;var ay,G,D,au,d,X,Y,z,o,c,ad;var l;var H="close",p="click",av="open";al(U);function U(){aq=al("#easyrecipeDialog");aq.dialog({autoOpen:false,width:645,modal:true,dialogClass:"wp-dialog",close:function(){if(aD&&!ax){aD.remove()}aD=false}});al("#divERContainer").show();F=al("#easyrecipeConvert");T=al("#divERCNVSpinner");e=al("#btnERCNVCancel");K=al("#btnERCNVOK");al("#divERCNVContainer").show();T.hide();F.dialog({autoOpen:false,width:350,modal:true,dialogClass:"wp-dialog"});ak=al("#ed_toolbar");S=al("#inpERName");aE=al("#inpERAuthor");N=al("#inpERType");u=al("textarea#taERSummary");x=al("textarea#taERIngredients");ah=al("textarea#taERInstructions");q=al("#inpERPrepTime");r=al("#inpERCookTime");P=al("#inpERYield");ay=al("#inpERServeSize");G=al("#inpERCalories");D=al("#inpERFat");au=al("#inpERSatFat");d=al("#inpERUnsatFat");X=al("#inpERCarbs");Y=al("#inpERSugar");z=al("#inpERFiber");o=al("#inpERProtein");c=al("#inpERCholestrol");ad=al("textarea#taERNotes");E=al(".ERTimeError");V=al("#divERAdd");O=al("#divERChange");I=al("#divERHeader");R=al("#divEROther");am=al("#divEROtherLabel");v=al("#divERNotes");ab=al("#divERNotesLabel");al("#easyrecipeLaunch").click(L);al("#btnERAdd").click(A);al("#btnERChange").click(A);al("#btnERDelete").click(af);al("#btnERCancel").click(at);am.click(t);ab.click(aA);al("#inpERPrepTime").change(function(aI){ao(al(aI.target))});al("#inpERCookTime").change(function(aI){ao(al(aI.target))});ak.append(al(aH).click(function(){alert(aB)}))}function f(){e.unbind(p);K.unbind(p);F.dialog(H);B=true;L()}function M(aM,aJ){var aL,aI="",aK=aM.recipe;if(aJ!="success"){F.dialog(H);B=true;L()}S.val(ae(aK.recipe_title));N.val("");aE.val("");u.val(ae(aK.summary));ai=Z.exec(aK.prep_time);if(ai!=null){aL=ai[1]?ai[1]+"h ":"";q.val(aL+ai[2]+"m")}else{q.val(ae(aK.prep_time))}ai=Z.exec(aK.cook_time);if(ai!=null){aL=ai[1]?ai[1]+"h ":"";r.val(aL+ai[2]+"m")}else{r.val(ae(aK.cook_time))}P.val(ae(aK.yield));G.val(ae(aK.calories));D.val(ae(aK.fat));ay.val(ae(aK.serving_size));for(aL=0;aL<aM.ingredients.length;aL++){aI+=Q(ae(aM.ingredients[aL]))+"\n"}x.val(aI);ah.val(ae(aK.instructions.replace("\r","")));I.html("Update Recipe");F.dialog(H);V.hide();O.show();s=true;aD=C();aq.dialog(ap,J,a);aq.dialog(av)}function g(){T.show();e.unbind(p);K.unbind(p);var aI={action:"convertRecipeSEO",id:l};al.post(ajaxurl,aI,M,"json")}function ao(aM){var aI=al.trim(aM.val()),aJ=0,aL=0,aK,aN;E.hide();if(aI==""){return true}ai=h.exec(aI);if(ai==null){ai=W.exec(aI);if(ai==null){E.show();return false}aJ=0;aL=ai[1]}else{aJ=ai[1]?parseInt(ai[1]):0;aL=ai[2]?parseInt(ai[2]):0}if(aJ==0&&aL==0){aM.val("")}else{aK=aJ>0?aJ+" hour":"";if(aJ>1){aK+="s"}aN=aL>0?aL+" min":"";if(aL>1){aN+="s"}aM.val(al.trim(aK+" "+aN))}return true}function j(aM){var aJ,aI,aK,aL="";for(aJ=0;aJ<aM.length;aJ++){aI=aM[aJ];if(aI.nodeType==3){aK=al.trim(aI.nodeValue);if(aK!=""){aL+=aK+"\n"}continue}if(aI.nodeType!=1){continue}if(aI.childNodes.length>0){aL+=j(aI.childNodes)}}return aL}function C(){al(aC,ar).remove();var aI=aF.selection.getNode();if(aI.tagName.toLowerCase()=="body"){al(aI).append("&nbsp;"+ag)}else{while(aI.parentNode.tagName.toLowerCase()!="body"){aI=aI.parentNode}if(aI.tagName.toLowerCase()=="div"||aI.tagName.toLowerCase()=="span"){al(aI,ar).after(ag)}else{al(aI,ar).before(ag)}}return al(aC,ar)}function L(){var aQ,aL;var aM="",aK="";an=false;if(typeof tinyMCE!="undefined"){if(tinyMCE.activeEditor&&!tinyMCE.activeEditor.isHidden()){an=true}}if(!an){alert("You must use the Visual Editor to add or update an Easy Recipe");return}aF=tinyMCE.activeEditor;S.val("");N.val("");aE.val("");u.val("");q.val("");r.val("");P.val("");x.val("");ah.val("");ay.val("");G.val("");D.val("");au.val("");d.val("");X.val("");Y.val("");z.val("");o.val("");c.val("");ad.val("");aD=al(".easyrecipe",ar);if(aD.length>0){I.html("Update Recipe");V.hide();O.show();ax=true}else{y=aF.getContent();if(!B){aL=m.exec(y);if(aL){l=aL[2];T.hide();e.click(f);K.click(g);F.dialog(ap,J,a);F.dialog(av);return}}V.show();O.hide();I.html("Add a New Recipe");ax=false;var aO=aF.selection.getContent();if(aO.length>20){aO=al("<div>"+aO+"</div>");var aP=j(aO[0].childNodes);aP=aP.split("\n");var aN=false;for(aO=0;aO<aP.length;aO++){if(/^(?:instruction|method|cooking method)/i.test(aP[aO])){aN=true;continue}if(/^Ingredient/i.test(aP[aO])){continue}if(!aN){aM+=aP[aO]+"\n"}else{aK+=aP[aO]+"\n"}}}aD=C()}aj=false;if(al(".hrecipe",ar).length>0){if(ax){}else{if(confirm("This post is already hrecipe microformatted\n\nDo you want me to try to convert it to an EasyRecipe?")){aj=true}}}var aI=ar.find(".fn").html();if(typeof aI=="undefined"||!aI){S.val(ae(al("#title").val()))}else{S.val(ae(aI))}N.val(ae(ar.find(".tag").html()));aE.val(ae(ar.find(".author").html()));u.val(ae(ar.find(".summary").html()));var aJ=ar.find(".preptime").html();aL=aG.exec(ar.find(".preptime").html());if(aL!=null){q.val(ae(aL[1]))}else{q.val("")}aL=aG.exec(ar.find(".cooktime").html());if(aL!=null){r.val(ae(aL[1]))}else{r.val("")}P.val(ae(ar.find(".yield").html()));ar.find(".ingredients li").each(function(aS,aR){if(al(aR).hasClass(k)){aM+="!"+ae(aR.innerHTML)+"\n"}else{aM+=ae(aR.innerHTML)+"\n"}});x.val(aM);ar.find(".instructions li, .instructions .ERSeparator").each(function(aS,aR){aQ=al.trim(aR.innerHTML.replace(/^[ 0-9.]*(.*)$/ig,"$1"));if(al(aR).hasClass(k)){aK+="!"+aQ+"\n"}else{aK+=aQ+"\n"}});ah.val(ae(aK));ay.val(ae(ar.find(".servingSize").html()));G.val(ae(ar.find(".calories").html()));D.val(ae(ar.find(".fat").html()));au.val(ae(ar.find(".saturatedFat").html()));d.val(ae(ar.find(".unsaturatedFat").html()));X.val(ae(ar.find(".carbohydrates").html()));Y.val(ae(ar.find(".sugar").html()));z.val(ae(ar.find(".fiber").html()));o.val(ae(ar.find(".protein").html()));c.val(ae(ar.find(".cholestrol").html()));aQ=(al(".ERNotes",ar).html()||"").replace(/<\/p>\n*<p>/ig,"\n\n").replace(/(?:<p>|<\/p>)/ig,"").replace(/<br *\/?>/ig,"\n");ad.val(aQ);aq.dialog(ap,J,a);aq.dialog(av)}function at(){aq.dialog(H)}function af(){var aI=confirm("Are you sure you want to delete this recipe?");if(aI){aD.remove();aD=false}aq.dialog(H)}function A(){var aV,aP="",aN,aU="",aJ=0,aL="";var a0,aX,aT,aO,aZ,aQ,aW,aK=[],aI;if(!ao(q)){return}if(!ao(r)){return}aN=al.trim(q.val());if(aN!=""){ai=h.exec(aN);a0=ai[1]?parseInt(ai[1]):0;aX=ai[2]?parseInt(ai[2]):0;aJ=a0*60+aX;aT=a0>0?a0+"H":"";aO=aX>0?aX+"M":"";aU="PT"+aT+aO}else{aN=false}aV=al.trim(r.val());if(aV!=""){ai=h.exec(aV);a0=ai[1]?parseInt(ai[1]):0;aX=ai[2]?parseInt(ai[2]):0;aT=a0>0?a0+"H":"";aO=aX>0?aX+"M":"";aJ+=a0*60+aX;aP="PT"+aT+aO}else{aV=false}if(aJ>0){a0=Math.floor(aJ/60);aX=aJ%60;aT=a0>0?a0+" hour":"";if(a0>1){aT+="s"}aO=aX>0?aX+" min":"";if(aX>1){aO+="s"}aJ=al.trim(aT+" "+aO);aT=a0>0?a0+"H":"";aO=aX>0?aX+"M":"";aL="PT"+aT+aO}else{aJ=false}aZ=x.val().split("\n");for(aW=0;aW<aZ.length;aW++){aQ=al.trim(aZ[aW].replace(/^[^0-9a-z!]*(.*)$/ig,"$1"));if(aQ!=""){if(aQ.charAt(0)=="!"){aI=true;aQ=aQ.substr(1)}else{aI=false}aK.push({ingredient:ac(aQ),isSeparator:aI})}}aZ=ah.val().split("\n");var aY=[];var aM={INSTRUCTIONS:[]};for(aW=0;aW<aZ.length;aW++){aQ=al.trim(aZ[aW].replace(/^[ 0-9.]*(.*)$/ig,"$1"));if(aQ!=""){if(aQ.charAt(0)=="!"){if(aM.INSTRUCTIONS.length>0||aM.separator){aY.push(aM)}aQ=aQ.substr(1);aM=new Object();aM.INSTRUCTIONS=[];aM.separator=ac(aQ)}else{aM.INSTRUCTIONS.push({instruction:ac(aQ)})}}}if(aM.INSTRUCTIONS.length>0||aM.separator){aY.push(aM)}aQ=aa(ad);if(aQ){aQ="<p>"+aQ.replace(/\n\n/ig,"</p><p>").replace(/\n/ig,"<br />")+"</p>"}var aS={version:EASYRECIPE.version,name:ac(S.val()),author:aa(aE),preptime:aN,cooktime:aV,duration:aJ,preptimeISO:aU,cooktimeISO:aP,durationISO:aL,yield:aa(P),type:aa(N),summary:aa(u),servesize:aa(ay),calories:aa(G),fat:aa(D),satfat:aa(au),unsatfat:aa(d),carbs:aa(X),sugar:aa(Y),fiber:aa(z),protein:aa(o),cholestrol:aa(c),notes:aQ,INGREDIENTS:aK,STEPS:aY};var aR=az(EASYRECIPE.recipeTemplate,aS);if(aj){al(".hrecipe",ar).remove()}aD.before(aR);aD.remove();aD=false;aq.dialog(H);b()}function aa(aI){return al.trim(ac(aI.val()))||false}function b(){var aI=al(".easyrecipe",ar);aI.mousedown(function(aJ){aJ.stopPropagation();L()})}function i(aL,aJ,aM){var aK;if(aJ.editorId=="content"){ar=al("#content_ifr").contents();a=1000;aK=al("#content_easyrecipeTest")}else{ar=al("#mce_fullscreen_ifr").contents();a=200001;aK=al("#mce_fullscreen_easyrecipeTest")}var aI=al(".easyrecipe",ar);if(al(".easyrecipe",ar).length>0&&EASYRECIPE.testURL!=""){aK.show()}else{aK.hide()}if(!ar.hasERCSS){al("head",ar).append('<link rel="stylesheet" type="text/css" href="'+EASYRECIPE.pluginsURL+'/easyrecipe/easyrecipe-admin.css" />');ar.hasERCSS=true}b()}function t(){R.toggleClass("ERNone");am.toggleClass("ERContract")}function aA(){v.toggleClass("ERNone");ab.toggleClass("ERContract")}function ae(aI){return aI?aI.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):""}function ac(aI){return aI?al("<div />").text(aI).html():""}function az(bc,aY){var a4=0,aZ=1,aI=2,be;var a5,aW,aP,aV="",aU="",a7,aJ,aM,a6,a9;var a8="<!-- START REPEAT ",bg="<!-- START INCLUDEIF ",bf="<!-- END INCLUDEIF ";var aL,aK,aR,bb,a2,aQ,aX,a3,bd,aT;var aN,a1,ba;var aS,a0,aO;be=bc;aY=aY||{};while(true){a7=be.length;aJ=be.indexOf("#",aV);if(aJ!==-1){a7=aJ;aM=a4}a6=be.indexOf(a8,aV);if(a6!==-1&&a6<a7){a7=a6;aM=aZ}a9=be.indexOf(bg,aV);if(a9!==-1&&a9<a7){a7=a9;aM=aI}if(a7==be.length){return aU+be.substr(aV)}aL=a7-aV;aU+=be.substr(aV,aL);aV=a7;switch(aM){case aI:aW=be.substr(aV,44);aP=w.exec(aW);if(aP!=null){aK=aP[1];aR=aK!="!";bb=aP[2]}else{break}a2=bf+aK+bb+" -->";aQ=a2.length;aX=be.indexOf(a2);if(aX==-1){aV++;break}a3=typeof aY[bb]!=="undefined"&&aY[bb]!==false;if(a3===aR){bd="<!-- START INCLUDEIF "+aK+bb+" -->";aT=bd.length;be=be.substr(0,aV)+be.substr(aV+aT,aX-aV-aT)+be.substr(aX+aQ)}else{be=be.substr(0,aV)+be.substr(aX+aQ)}break;case a4:aW=be.substr(aV,22);aP=aw.exec(aW);if(aP===null){aU+="#";aV++;continue}aN=aP[1];if(aY[aN]!=""&&!aY[aN]){aU+="#"+aN+"#";aV+=aN.length+2;continue}aU+=aY[aN];aV+=aN.length+2;break;case aZ:aW=be.substr(aV,45);aP=n.exec(aW);if(aP===null){aU+="<";aV++;continue}a1=aP[1];if(!aY[a1]||!(aY[a1] instanceof Array)){aU+="<";aV++;continue}aV+=a1.length+22;ba=be.indexOf("<!-- END REPEAT "+a1+" -->",aV);if(ba===-1){aU+="<!-- START REPEAT "+a1+" -->";continue}aS=ba-aV;a0=be.substr(aV,aS);aO=aY[a1];for(a5=0;a5<aO.length;a5++){aU+=az(a0,aO[a5])}aV+=a1.length+aS+20;break}}}})();