(function(d){var a="mceNonEditable";var b=null;var c=false;tinymce.create("tinymce.plugins.EasyRecipe",{init:function(e,f){f=f.replace(/js$/g,"images/");e.onLoadContent.add(function(g,h){if(g.editorId!=="mce_fullscreen"){d(window).trigger("easyrecipeload",[g,h])}});e.onSetContent.add(function(g,h){if(g.editorId==="mce_fullscreen"&&!h.initial){d(window).trigger("easyrecipeload",[g,h])}});e.addButton("easyrecipeEdit",{title:"Edit an EasyRecipe",image:f+"chef20edit.png",onclick:function(){d(window).trigger("easyrecipeedit")}});e.addButton("easyrecipeAdd",{title:"Add an EasyRecipe",image:f+"chef20add.png",onclick:function(){d(window).trigger("easyrecipeadd")}});e.addButton("easyrecipeTest",{title:"Test Rich Snippet Formatting at Google",image:f+"google.png",onclick:function(){if(EASYRECIPE.testURL!==""){window.open("http://www.google.com/webmasters/tools/richsnippets?url="+EASYRECIPE.testURL)}}});e.onKeyDown.addToTop(function(h,k){var g,j;var i,l;if(k.keyCode===8){l=h.dom.getParent(h.selection.getStart(),function(m){return h.dom.hasClass(m,a)});i=h.dom.getParent(h.selection.getEnd(),function(m){return h.dom.hasClass(m,a)});if(l||i){return tinymce.dom.Event.cancel(k)}}else{if(k.keyCode===46){g=h.selection.getNode();j=d(g);if(j.hasClass("easyrecipeAbove")){return tinymce.dom.Event.cancel(k)}if(j.text().indexOf("_ERSTOP_")!==-1){h.undoManager.undo();EASYRECIPE.addListener();return}if(g.parentNode.nodeName==="P"&&g.parentNode.children.length==1){if(!c&&d(g.parentNode.nextSibling).hasClass(a)){g.parentNode.parentNode.removeChild(g.parentNode);EASYRECIPE.addListener();return tinymce.dom.Event.cancel(k)}}b=d(g.nextSibling);if(!c&&b.hasClass(a)){j.after('<div id="ERStop">_ERSTOP_</div>');c=true;b=d(g.nextSibling)}h.undoManager.add()}}});e.onKeyUp.addToTop(function(h,j){var k,i,g;if(j.keyCode===46){g=h.selection.getNode();if(d(g).text().indexOf("_ERSTOP_")!==-1){h.undoManager.undo();EASYRECIPE.addListener()}k=d("#ERStop",h.getDoc());k.remove();c=false}else{if(j.keyCode===8){k=h.dom.getParent(h.selection.getStart(),function(l){return h.dom.hasClass(l,a)});i=h.dom.getParent(h.selection.getEnd(),function(l){return h.dom.hasClass(l,a)});if(k||i){h.undoManager.undo();EASYRECIPE.addListener()}}}});e.onBeforeExecCommand.add(function(h,l,k,n,j){var g,i,m;if(l!=="mceInsertContent"){return}if(EASYRECIPE.isEntryDialog){d(window).trigger("easyrecipeimage",n);j.terminate=true;return false}g=h.selection.getNode();i=d(g).parents(".easyrecipe");if(i.length>0){m=d("<p>").insertAfter(i);h.selection.select(m[0])}});e.onPreProcess.add(function(g,h){if(h.get){d(".value-title, .ERRatingInner",h.node).html("#ERDeleteMe#")}});e.onPostProcess.add(function(g,h){if(h.get){h.content=h.content.replace(/#ERDeleteMe#/ig," ")}})},getInfo:function(){return{longname:"EasyRecipe",author:"The Orgasmic Chef",authorurl:"http://www.orgasmicchef.com",infourl:"http://www.easyrecipeplugin.com/",version:"1.2"}}});tinymce.PluginManager.add("easyrecipe",tinymce.plugins.EasyRecipe)}(jQuery));